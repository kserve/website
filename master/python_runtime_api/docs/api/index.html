
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="KServe Documentation" name="description"/>
<link href="https://kserve.io/website/master/python_runtime_api/docs/api/" rel="canonical"/>
<link href="../../../images/favicon/favicon-32x32.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-8.0.5" name="generator"/>
<title>KServe Python Serving Runtime API - KServe Documentation Website</title>
<link href="../../../assets/stylesheets/main.a617204b.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.9204c3b2.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#kserve-python-serving-runtime-api">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
<aside class="md-banner">
<div class="md-banner__inner md-grid md-typeset">
<h1>
<b>KServe v0.13 is Released</b>, <a href="/website/0.13/blog/articles/2024-05-15-KServe-0.13-release/">Read blog &gt;&gt;</a>
</h1>
</div>
</aside>
</div>
<div data-md-component="outdated" hidden="">
<aside class="md-banner md-banner--warning">
</aside>
</div>
<header class="md-header md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="KServe Documentation Website" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="KServe Documentation Website">
<img alt="logo" src="../../../images/logo/kserve.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            KServe Documentation Website
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              KServe Python Serving Runtime API
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/kserve/kserve" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../get_started/">
        Getting started
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../admin/serverless/serverless/">
        Administration Guide
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../modelserving/control_plane/">
        User Guide
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../reference/api/">
        API Reference
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../developer/developer/">
        Developer Guide
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../blog/articles/2024-05-15-KServe-0.13-release/">
        Blog
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../community/get_involved/">
        Community
      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="KServe Documentation Website" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="KServe Documentation Website">
<img alt="logo" src="../../../images/logo/kserve.png"/>
</a>
    KServe Documentation Website
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/kserve/kserve" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          Getting started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Getting started" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../get_started/">
        KServe Quickstart
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../get_started/first_isvc/">
        First InferenceService
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../get_started/swagger_ui/">
        Interact with InferenceService Swagger UI
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          Administration Guide
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Administration Guide" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Administration Guide
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" id="__nav_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1">
          Install KServe
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Install KServe" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_1">
<span class="md-nav__icon md-icon"></span>
          Install KServe
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_1" id="__nav_3_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1_1">
          Serverless
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Serverless" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_1_1">
<span class="md-nav__icon md-icon"></span>
          Serverless
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/serverless/serverless/">
        Serverless installation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/serverless/servicemesh/">
        Istio Service Mesh
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/serverless/kourier_networking/">
        Kourier Networking Layer
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/modelmesh/">
        ModelMesh installation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/kubernetes_deployment/">
        Kubernetes deployment installation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/migration/">
        Migrating from KFServing
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
          User Guide
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="User Guide" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" id="__nav_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1">
          Concepts
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Concepts" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_1" id="__nav_4_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_1">
          Control Plane
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Control Plane" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_1">
<span class="md-nav__icon md-icon"></span>
          Control Plane
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/control_plane/">
        Model Serving Control Plane
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_2" id="__nav_4_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_2">
          Data Plane
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Data Plane" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_2">
<span class="md-nav__icon md-icon"></span>
          Data Plane
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/data_plane/data_plane/">
        Model Serving Data Plane
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/data_plane/v1_protocol/">
        V1 Inference Protocol
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/data_plane/v2_protocol/">
        Open Inference Protocol (V2 Inference Protocol)
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/servingruntimes/">
        Serving Runtimes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
          Model Serving Runtimes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Model Serving Runtimes" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Model Serving Runtimes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_1" id="__nav_4_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_1">
          Supported Model Frameworks/Formats
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Supported Model Frameworks/Formats" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_1">
<span class="md-nav__icon md-icon"></span>
          Supported Model Frameworks/Formats
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/serving_runtime/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/tensorflow/">
        Tensorflow
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/torchserve/">
        PyTorch
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/sklearn/v2/">
        Scikit-learn
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/xgboost/">
        XGBoost
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/pmml/">
        PMML
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/spark/">
        Spark MLlib
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/lightgbm/">
        LightGBM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/paddle/">
        Paddle
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/mlflow/v2/">
        MLFlow
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/onnx/">
        ONNX
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_2" id="__nav_4_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_2">
          Multi-Framework Serving Runtimes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Multi-Framework Serving Runtimes" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_2">
<span class="md-nav__icon md-icon"></span>
          Multi-Framework Serving Runtimes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_2_1" id="__nav_4_2_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_2_1">
          Nvidia Triton
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Nvidia Triton" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_4_2_2_1">
<span class="md-nav__icon md-icon"></span>
          Nvidia Triton
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/triton/torchscript/">
        Torchscript
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/triton/bert/">
        Tensorflow
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/triton/huggingface/">
        Hugging Face
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/amd/">
        AMD
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_3" id="__nav_4_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_3">
          LLM Runtime
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="LLM Runtime" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_3">
<span class="md-nav__icon md-icon"></span>
          LLM Runtime
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_3_1" id="__nav_4_2_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_3_1">
          Hugging Face LLM
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Hugging Face LLM" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_4_2_3_1">
<span class="md-nav__icon md-icon"></span>
          Hugging Face LLM
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/llm/huggingface/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/llm/huggingface/text_generation/">
        Text Generation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/llm/huggingface/text2text_generation/">
        Text2Text Generation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/llm/huggingface/token_classification/">
        Token Classification
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/llm/huggingface/text_classification/">
        Text Classification
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/llm/huggingface/fill_mask/">
        Fill Mask
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/llm/torchserve/accelerate/">
        TorchServe LLM
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/custom/custom_model/">
        How to write a custom predictor
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3">
          Multi Model Serving
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Multi Model Serving" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Multi Model Serving
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1" id="__nav_4_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3_1">
          Overview
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Overview" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_3_1">
<span class="md-nav__icon md-icon"></span>
          Overview
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/mms/multi-model-serving/">
        The Scalability Problem
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/mms/modelmesh/overview/">
        ModelMesh Overview
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4">
          Transformers
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Transformers" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
          Transformers
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/transformer/feast/">
        Feast
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/transformer/torchserve_image_transformer/">
        How to write a custom transformer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/transformer/collocation/">
        Collocate transformer and predictor
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5">
          Inference Graph
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Inference Graph" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
          Inference Graph
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/inference_graph/">
        Concept
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/inference_graph/image_pipeline/">
        Image classification inference graph
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6">
          Model Storage
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Model Storage" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
          Model Storage
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/storage/storagecontainers/">
        Storage Containers
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/storage/azure/azure/">
        Azure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/storage/pvc/pvc/">
        PVC
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/storage/s3/s3/">
        S3
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/storage/oci/">
        OCI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/storage/uri/uri/">
        URI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/certificate/kserve/">
        CA Certificate
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/storage/gcs/gcs/">
        GCS
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_7" id="__nav_4_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_7">
          Model Explainability
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Model Explainability" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_7">
<span class="md-nav__icon md-icon"></span>
          Model Explainability
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/explainer/explainer/">
        Concept
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_7_2" id="__nav_4_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_7_2">
          Alibi Explainer
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Alibi Explainer" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_7_2">
<span class="md-nav__icon md-icon"></span>
          Alibi Explainer
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/explainer/alibi/cifar10/">
        Image Explainer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/explainer/alibi/income/">
        Income Explainer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/explainer/alibi/moviesentiment/">
        Text Explainer
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/explainer/aix/mnist/aix/">
        AIX Explainer
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_8" id="__nav_4_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_8">
          Model Monitoring
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Model Monitoring" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_8">
<span class="md-nav__icon md-icon"></span>
          Model Monitoring
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/detect/alibi_detect/alibi_detect/">
        Alibi Detector
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/detect/aif/germancredit/">
        AIF Bias Detector
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/detect/art/mnist/">
        ART Adversarial Detector
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_9" id="__nav_4_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_9">
          Request Batching
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Request Batching" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_9">
<span class="md-nav__icon md-icon"></span>
          Request Batching
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/batcher/batcher/">
        Inference Batcher
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_10" id="__nav_4_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_10">
          Payload Logging
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Payload Logging" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_10">
<span class="md-nav__icon md-icon"></span>
          Payload Logging
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/logger/logger/">
        Inference Logger
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_11" id="__nav_4_11" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_11">
          Autoscaling
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Autoscaling" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_11">
<span class="md-nav__icon md-icon"></span>
          Autoscaling
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/autoscaling/autoscaling/">
        Inference Autoscaling
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_12" id="__nav_4_12" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_12">
          Node Scheduling
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Node Scheduling" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_12">
<span class="md-nav__icon md-icon"></span>
          Node Scheduling
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/nodescheduling/overview/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/nodescheduling/inferenceservicenodescheduling/">
        InferenceService Node Scheduling
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_13" id="__nav_4_13" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_13">
          Kafka
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Kafka" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_13">
<span class="md-nav__icon md-icon"></span>
          Kafka
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/kafka/kafka/">
        Inference with Kafka event source
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_14" id="__nav_4_14" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_14">
          Rollout Strategies
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Rollout Strategies" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_14">
<span class="md-nav__icon md-icon"></span>
          Rollout Strategies
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/rollout/canary/">
        Canary
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/v1beta1/rollout/canary-example/">
        Canary Example
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_15" id="__nav_4_15" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_15">
          Inference Observability
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Inference Observability" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_15">
<span class="md-nav__icon md-icon"></span>
          Inference Observability
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/observability/prometheus_metrics/">
        Prometheus Metrics
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../modelserving/observability/grafana_dashboards/">
        Grafana Dashboards
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
          API Reference
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="API Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/api/">
        Control Plane API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/swagger-ui/">
        Open Inference Protocol API Spec
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../sdk_docs/sdk_doc/">
        Python Client SDK
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        Python Runtime Server SDK
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
          Developer Guide
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Developer Guide" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../developer/developer/">
        How to contribute
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../developer/debug/">
        Debugging guide
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7">
          Blog
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Blog" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Blog
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" id="__nav_7_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_1">
          Releases
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Releases" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_1">
<span class="md-nav__icon md-icon"></span>
          Releases
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2024-05-15-KServe-0.13-release/">
        KServe 0.13 Release
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2023-10-08-KServe-0.11-release/">
        KServe 0.11 Release
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2023-02-05-KServe-0.10-release/">
        KServe 0.10 Release
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2022-07-21-KServe-0.9-release/">
        KServe 0.9 Release
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2022-02-18-KServe-0.8-release/">
        KServe 0.8 Release
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2021-10-11-KServe-0.7-release/">
        KServe 0.7 Release
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" id="__nav_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_2">
          Articles
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Articles" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_2">
<span class="md-nav__icon md-icon"></span>
          Articles
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2021-09-27-kfserving-transition/">
        KFserving Transition
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8">
          Community
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Community" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
          Community
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../community/get_involved/">
        How to Get Involved
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../community/adopters/">
        Adopters
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../community/presentations/">
        Demos and Presentations
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model_server">
    model_server
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model_server.ModelServer">
    ModelServer
  </a>
<nav aria-label="ModelServer" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model_server.ModelServer.__init__">
    __init__
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model_server.ModelServer.default_exception_handler">
    default_exception_handler
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model_server.ModelServer.register_exception_handler">
    register_exception_handler
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model_server.ModelServer.register_model">
    register_model
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model_server.ModelServer.start">
    start
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model_server.ModelServer.stop">
    stop
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model">
    model
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.BaseKServeModel">
    BaseKServeModel
  </a>
<nav aria-label="BaseKServeModel" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.BaseKServeModel.__init__">
    __init__
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.BaseKServeModel.healthy">
    healthy
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.BaseKServeModel.load">
    load
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.BaseKServeModel.start">
    start
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.BaseKServeModel.stop">
    stop
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.InferenceModel">
    InferenceModel
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.Model">
    Model
  </a>
<nav aria-label="Model" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.Model.__call__">
    __call__
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.Model.__init__">
    __init__
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.Model.explain">
    explain
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.Model.load">
    load
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.Model.postprocess">
    postprocess
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.Model.predict">
    predict
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.Model.preprocess">
    preprocess
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.PredictorConfig">
    PredictorConfig
  </a>
<nav aria-label="PredictorConfig" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.model.PredictorConfig.__init__">
    __init__
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type">
    infer_type
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput">
    InferInput
  </a>
<nav aria-label="InferInput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput.data">
    data
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput.datatype">
    datatype
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput.name">
    name
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput.parameters">
    parameters
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput.shape">
    shape
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput.__init__">
    __init__
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput.as_numpy">
    as_numpy
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput.as_string">
    as_string
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferInput.set_data_from_numpy">
    set_data_from_numpy
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferOutput">
    InferOutput
  </a>
<nav aria-label="InferOutput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferOutput.data">
    data
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferOutput.datatype">
    datatype
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferOutput.name">
    name
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferOutput.parameters">
    parameters
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferOutput.shape">
    shape
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferOutput.__init__">
    __init__
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferOutput.as_numpy">
    as_numpy
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferOutput.set_data_from_numpy">
    set_data_from_numpy
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest">
    InferRequest
  </a>
<nav aria-label="InferRequest" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest.use_binary_outputs">
    use_binary_outputs
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest.__init__">
    __init__
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest.as_dataframe">
    as_dataframe
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest.from_bytes">
    from_bytes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest.from_grpc">
    from_grpc
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest.from_inference_request">
    from_inference_request
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest.get_input_by_name">
    get_input_by_name
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest.to_grpc">
    to_grpc
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferRequest.to_rest">
    to_rest
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferResponse">
    InferResponse
  </a>
<nav aria-label="InferResponse" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferResponse.__init__">
    __init__
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferResponse.from_bytes">
    from_bytes
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferResponse.from_grpc">
    from_grpc
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferResponse.from_rest">
    from_rest
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferResponse.get_output_by_name">
    get_output_by_name
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferResponse.to_grpc">
    to_grpc
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.InferResponse.to_rest">
    to_rest
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.RequestedOutput">
    RequestedOutput
  </a>
<nav aria-label="RequestedOutput" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.RequestedOutput.binary_data">
    binary_data
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.RequestedOutput.name">
    name
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.RequestedOutput.parameters">
    parameters
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.RequestedOutput.__init__">
    __init__
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.deserialize_bytes_tensor">
    deserialize_bytes_tensor
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.serialize_byte_tensor">
    serialize_byte_tensor
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.to_grpc_parameters">
    to_grpc_parameters
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kserve.protocol.infer_type.to_http_parameters">
    to_http_parameters
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/kserve/website/edit/main/docs/python_runtime_api/docs/api.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="kserve-python-serving-runtime-api">KServe Python Serving Runtime API<a class="headerlink" href="#kserve-python-serving-runtime-api" title="Permanent link"></a></h1>
<div class="doc doc-object doc-module">
<a id="kserve.model_server"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.model_server.ModelServer">
<code>ModelServer</code>
<a class="headerlink" href="#kserve.model_server.ModelServer" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>kserve/model_server.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ModelServer</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">http_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">http_port</span><span class="p">,</span>
        <span class="n">grpc_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">grpc_port</span><span class="p">,</span>
        <span class="n">workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">workers</span><span class="p">,</span>
        <span class="n">max_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_threads</span><span class="p">,</span>
        <span class="n">max_asyncio_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_asyncio_workers</span><span class="p">,</span>
        <span class="n">registered_models</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelRepository</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">enable_grpc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_grpc</span><span class="p">,</span>
        <span class="n">enable_docs_url</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_docs_url</span><span class="p">,</span>
        <span class="n">enable_latency_logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_latency_logging</span><span class="p">,</span>
        <span class="n">access_log_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">access_log_format</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""KServe ModelServer Constructor</span>

<span class="sd">        Args:</span>
<span class="sd">            http_port: HTTP port. Default: ``8080``.</span>
<span class="sd">            grpc_port: GRPC port. Default: ``8081``.</span>
<span class="sd">            workers: Number of uvicorn workers. Default: ``1``.</span>
<span class="sd">            max_threads: Max number of gRPC processing threads. Default: ``4``</span>
<span class="sd">            max_asyncio_workers: Max number of AsyncIO threads. Default: ``None``</span>
<span class="sd">            registered_models: A optional Model repository with registered models.</span>
<span class="sd">            enable_grpc: Whether to turn on grpc server. Default: ``True``</span>
<span class="sd">            enable_docs_url: Whether to turn on ``/docs`` Swagger UI. Default: ``False``.</span>
<span class="sd">            enable_latency_logging: Whether to log latency metric. Default: ``True``.</span>
<span class="sd">            access_log_format: Format to set for the access log (provided by asgi-logger). Default: ``None``.</span>
<span class="sd">                               it allows to override only the `uvicorn.access`'s format configuration with a richer</span>
<span class="sd">                               set of fields (output hardcoded to `stdout`). This limitation is currently due to the</span>
<span class="sd">                               ASGI specs that don't describe how access logging should be implemented in detail</span>
<span class="sd">                               (please refer to this Uvicorn</span>
<span class="sd">                               [github issue](https://github.com/encode/uvicorn/issues/527) for more info).</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">ModelRepository</span><span class="p">()</span> <span class="k">if</span> <span class="n">registered_models</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">registered_models</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">http_port</span> <span class="o">=</span> <span class="n">http_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grpc_port</span> <span class="o">=</span> <span class="n">grpc_port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">workers</span> <span class="o">=</span> <span class="n">workers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_threads</span> <span class="o">=</span> <span class="n">max_threads</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span> <span class="o">=</span> <span class="n">max_asyncio_workers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_grpc</span> <span class="o">=</span> <span class="n">enable_grpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_docs_url</span> <span class="o">=</span> <span class="n">enable_docs_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_latency_logging</span> <span class="o">=</span> <span class="n">enable_latency_logging</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataplane</span> <span class="o">=</span> <span class="n">DataPlane</span><span class="p">(</span><span class="n">model_registry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_repository_extension</span> <span class="o">=</span> <span class="n">ModelRepositoryExtension</span><span class="p">(</span>
            <span class="n">model_registry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rest_server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_grpc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span> <span class="o">=</span> <span class="n">GRPCServer</span><span class="p">(</span>
                <span class="n">grpc_port</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataplane</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_repository_extension</span><span class="p">,</span>
                <span class="n">kwargs</span><span class="o">=</span><span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">:</span>
            <span class="c1"># If the logger does not have any handlers, then the logger is not configured.</span>
            <span class="c1"># For backward compatibility, we configure the logger here.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">log_config_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">access_log_format</span> <span class="o">=</span> <span class="n">access_log_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom_exception_handler</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_serve_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Starting uvicorn with </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="si">}</span><span class="s2"> workers"</span><span class="p">)</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"win32"</span><span class="p">,</span> <span class="s2">"win64"</span><span class="p">]:</span>
            <span class="n">sig_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGQUIT</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sig_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">SIGTERM</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">sig</span> <span class="ow">in</span> <span class="n">sig_list</span><span class="p">:</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">add_signal_handler</span><span class="p">(</span>
                <span class="n">sig</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="o">=</span><span class="n">sig</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">sig</span><span class="o">=</span><span class="n">s</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_custom_exception_handler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">set_exception_handler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_exception_handler</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loop</span><span class="o">.</span><span class="n">set_exception_handler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_custom_exception_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rest_server</span> <span class="o">=</span> <span class="n">UvicornServer</span><span class="p">(</span>
            <span class="n">app</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">http_port</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataplane</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_repository_extension</span><span class="p">,</span>
            <span class="c1"># By setting log_config to None we tell Uvicorn not to configure logging as it is already</span>
            <span class="c1"># configured by kserve.</span>
            <span class="n">log_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">access_log_format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_log_format</span><span class="p">,</span>
            <span class="n">workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">workers</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rest_server</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseKServeModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Start the model server with a set of registered models.</span>

<span class="sd">        Args:</span>
<span class="sd">            models: a list of models to register to the model server.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">at_least_one_model_ready</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">BaseKServeModel</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ready</span><span class="p">:</span>
                        <span class="n">at_least_one_model_ready</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                        <span class="c1"># pass whether to log request latency into the model</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">enable_latency_logging</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_latency_logging</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Model type should be 'BaseKServeModel'"</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">at_least_one_model_ready</span> <span class="ow">and</span> <span class="n">models</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoModelReady</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Unknown model collection type"</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># formula as suggest in https://bugs.python.org/issue35279</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Setting max asyncio worker threads as </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">set_default_executor</span><span class="p">(</span>
            <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">servers_task</span><span class="p">():</span>
            <span class="n">servers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_serve_rest</span><span class="p">()]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_grpc</span><span class="p">:</span>
                <span class="n">servers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_threads</span><span class="p">))</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">servers</span><span class="p">)</span>

        <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">servers_task</span><span class="p">())</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Stop the instances of REST and gRPC model servers.</span>

<span class="sd">        Args:</span>
<span class="sd">            sig: The signal to stop the server. Default: ``None``.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Stopping the model server"</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rest_server</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Stopping the rest server"</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rest_server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Stopping the grpc server"</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span><span class="o">.</span><span class="n">get_models</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span><span class="o">.</span><span class="n">unload</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register_exception_handler</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">AbstractEventLoop</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Add a custom handler as the event loop exception handler.</span>

<span class="sd">        If a handler is not provided, the default exception handler will be set.</span>

<span class="sd">        handler should be a callable object, it should have a signature matching '(loop, context)', where 'loop'</span>
<span class="sd">        will be a reference to the active event loop, 'context' will be a dict object (see `call_exception_handler()`</span>
<span class="sd">        documentation for details about context).</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom_exception_handler</span> <span class="o">=</span> <span class="n">handler</span>

    <span class="k">def</span> <span class="nf">default_exception_handler</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">AbstractEventLoop</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Default exception handler for event loop.</span>

<span class="sd">        This is called when an exception occurs and no exception handler is set.</span>
<span class="sd">        This can be called by a custom exception handler that wants to defer to the default handler behavior.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="s2">"exception"</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Caught exception: </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'exception'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"message: </span><span class="si">{</span><span class="w"> </span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'message'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">default_exception_handler</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">BaseKServeModel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Register a model to the model server.</span>

<span class="sd">        Args:</span>
<span class="sd">            model: The model object.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Failed to register model, model.name must be provided."</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Registering model: </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model_server.ModelServer.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">http_port</span><span class="p">,</span> <span class="n">grpc_port</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">grpc_port</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">workers</span><span class="p">,</span> <span class="n">max_threads</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">max_threads</span><span class="p">,</span> <span class="n">max_asyncio_workers</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">max_asyncio_workers</span><span class="p">,</span> <span class="n">registered_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enable_grpc</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">enable_grpc</span><span class="p">,</span> <span class="n">enable_docs_url</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">enable_docs_url</span><span class="p">,</span> <span class="n">enable_latency_logging</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">enable_latency_logging</span><span class="p">,</span> <span class="n">access_log_format</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">access_log_format</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.model_server.ModelServer.__init__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>KServe ModelServer Constructor</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>http_port</code></td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>HTTP port. Default: <code>8080</code>.</p>
</div>
</td>
<td>
<code><span title="args.http_port">http_port</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>grpc_port</code></td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>GRPC port. Default: <code>8081</code>.</p>
</div>
</td>
<td>
<code><span title="args.grpc_port">grpc_port</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>workers</code></td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>Number of uvicorn workers. Default: <code>1</code>.</p>
</div>
</td>
<td>
<code><span title="args.workers">workers</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>max_threads</code></td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>Max number of gRPC processing threads. Default: <code>4</code></p>
</div>
</td>
<td>
<code><span title="args.max_threads">max_threads</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>max_asyncio_workers</code></td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>Max number of AsyncIO threads. Default: <code>None</code></p>
</div>
</td>
<td>
<code><span title="args.max_asyncio_workers">max_asyncio_workers</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>registered_models</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="kserve.model_repository.ModelRepository">ModelRepository</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>A optional Model repository with registered models.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>enable_grpc</code></td>
<td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>Whether to turn on grpc server. Default: <code>True</code></p>
</div>
</td>
<td>
<code><span title="args.enable_grpc">enable_grpc</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>enable_docs_url</code></td>
<td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>Whether to turn on <code>/docs</code> Swagger UI. Default: <code>False</code>.</p>
</div>
</td>
<td>
<code><span title="args.enable_docs_url">enable_docs_url</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>enable_latency_logging</code></td>
<td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>Whether to log latency metric. Default: <code>True</code>.</p>
</div>
</td>
<td>
<code><span title="args.enable_latency_logging">enable_latency_logging</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>access_log_format</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>Format to set for the access log (provided by asgi-logger). Default: <code>None</code>.
               it allows to override only the <code>uvicorn.access</code>'s format configuration with a richer
               set of fields (output hardcoded to <code>stdout</code>). This limitation is currently due to the
               ASGI specs that don't describe how access logging should be implemented in detail
               (please refer to this Uvicorn
               <a href="https://github.com/encode/uvicorn/issues/527">github issue</a> for more info).</p>
</div>
</td>
<td>
<code><span title="args.access_log_format">access_log_format</span></code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model_server.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">http_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">http_port</span><span class="p">,</span>
    <span class="n">grpc_port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">grpc_port</span><span class="p">,</span>
    <span class="n">workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">workers</span><span class="p">,</span>
    <span class="n">max_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_threads</span><span class="p">,</span>
    <span class="n">max_asyncio_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">max_asyncio_workers</span><span class="p">,</span>
    <span class="n">registered_models</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelRepository</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">enable_grpc</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_grpc</span><span class="p">,</span>
    <span class="n">enable_docs_url</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_docs_url</span><span class="p">,</span>
    <span class="n">enable_latency_logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_latency_logging</span><span class="p">,</span>
    <span class="n">access_log_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">access_log_format</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""KServe ModelServer Constructor</span>

<span class="sd">    Args:</span>
<span class="sd">        http_port: HTTP port. Default: ``8080``.</span>
<span class="sd">        grpc_port: GRPC port. Default: ``8081``.</span>
<span class="sd">        workers: Number of uvicorn workers. Default: ``1``.</span>
<span class="sd">        max_threads: Max number of gRPC processing threads. Default: ``4``</span>
<span class="sd">        max_asyncio_workers: Max number of AsyncIO threads. Default: ``None``</span>
<span class="sd">        registered_models: A optional Model repository with registered models.</span>
<span class="sd">        enable_grpc: Whether to turn on grpc server. Default: ``True``</span>
<span class="sd">        enable_docs_url: Whether to turn on ``/docs`` Swagger UI. Default: ``False``.</span>
<span class="sd">        enable_latency_logging: Whether to log latency metric. Default: ``True``.</span>
<span class="sd">        access_log_format: Format to set for the access log (provided by asgi-logger). Default: ``None``.</span>
<span class="sd">                           it allows to override only the `uvicorn.access`'s format configuration with a richer</span>
<span class="sd">                           set of fields (output hardcoded to `stdout`). This limitation is currently due to the</span>
<span class="sd">                           ASGI specs that don't describe how access logging should be implemented in detail</span>
<span class="sd">                           (please refer to this Uvicorn</span>
<span class="sd">                           [github issue](https://github.com/encode/uvicorn/issues/527) for more info).</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ModelRepository</span><span class="p">()</span> <span class="k">if</span> <span class="n">registered_models</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">registered_models</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">http_port</span> <span class="o">=</span> <span class="n">http_port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">grpc_port</span> <span class="o">=</span> <span class="n">grpc_port</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">workers</span> <span class="o">=</span> <span class="n">workers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_threads</span> <span class="o">=</span> <span class="n">max_threads</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span> <span class="o">=</span> <span class="n">max_asyncio_workers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enable_grpc</span> <span class="o">=</span> <span class="n">enable_grpc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enable_docs_url</span> <span class="o">=</span> <span class="n">enable_docs_url</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enable_latency_logging</span> <span class="o">=</span> <span class="n">enable_latency_logging</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataplane</span> <span class="o">=</span> <span class="n">DataPlane</span><span class="p">(</span><span class="n">model_registry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_repository_extension</span> <span class="o">=</span> <span class="n">ModelRepositoryExtension</span><span class="p">(</span>
        <span class="n">model_registry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rest_server</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_grpc</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span> <span class="o">=</span> <span class="n">GRPCServer</span><span class="p">(</span>
            <span class="n">grpc_port</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataplane</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_repository_extension</span><span class="p">,</span>
            <span class="n">kwargs</span><span class="o">=</span><span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">:</span>
        <span class="c1"># If the logger does not have any handlers, then the logger is not configured.</span>
        <span class="c1"># For backward compatibility, we configure the logger here.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">configure_logging</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">log_config_file</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">access_log_format</span> <span class="o">=</span> <span class="n">access_log_format</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_custom_exception_handler</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model_server.ModelServer.default_exception_handler">
<code class="highlight language-python"><span class="n">default_exception_handler</span><span class="p">(</span><span class="n">loop</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.model_server.ModelServer.default_exception_handler" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Default exception handler for event loop.</p>
<p>This is called when an exception occurs and no exception handler is set.
This can be called by a custom exception handler that wants to defer to the default handler behavior.</p>
<details class="quote">
<summary>Source code in <code>kserve/model_server.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">default_exception_handler</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">AbstractEventLoop</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""Default exception handler for event loop.</span>

<span class="sd">    This is called when an exception occurs and no exception handler is set.</span>
<span class="sd">    This can be called by a custom exception handler that wants to defer to the default handler behavior.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="s2">"exception"</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Caught exception: </span><span class="si">{</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'exception'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"message: </span><span class="si">{</span><span class="w"> </span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'message'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">loop</span><span class="o">.</span><span class="n">default_exception_handler</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model_server.ModelServer.register_exception_handler">
<code class="highlight language-python"><span class="n">register_exception_handler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.model_server.ModelServer.register_exception_handler" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Add a custom handler as the event loop exception handler.</p>
<p>If a handler is not provided, the default exception handler will be set.</p>
<p>handler should be a callable object, it should have a signature matching '(loop, context)', where 'loop'
will be a reference to the active event loop, 'context' will be a dict object (see <code>call_exception_handler()</code>
documentation for details about context).</p>
<details class="quote">
<summary>Source code in <code>kserve/model_server.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">register_exception_handler</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">AbstractEventLoop</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""Add a custom handler as the event loop exception handler.</span>

<span class="sd">    If a handler is not provided, the default exception handler will be set.</span>

<span class="sd">    handler should be a callable object, it should have a signature matching '(loop, context)', where 'loop'</span>
<span class="sd">    will be a reference to the active event loop, 'context' will be a dict object (see `call_exception_handler()`</span>
<span class="sd">    documentation for details about context).</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_custom_exception_handler</span> <span class="o">=</span> <span class="n">handler</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model_server.ModelServer.register_model">
<code class="highlight language-python"><span class="n">register_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.model_server.ModelServer.register_model" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Register a model to the model server.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>model</code></td>
<td>
<code><a class="autorefs autorefs-internal" title="kserve.model.BaseKServeModel" href="#kserve.model.BaseKServeModel">BaseKServeModel</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The model object.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model_server.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">register_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">BaseKServeModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Register a model to the model server.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: The model object.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Failed to register model, model.name must be provided."</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Registering model: </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model_server.ModelServer.start">
<code class="highlight language-python"><span class="n">start</span><span class="p">(</span><span class="n">models</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.model_server.ModelServer.start" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Start the model server with a set of registered models.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>models</code></td>
<td>
<code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kserve.model.BaseKServeModel" href="#kserve.model.BaseKServeModel">BaseKServeModel</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>a list of models to register to the model server.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model_server.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">models</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseKServeModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Start the model server with a set of registered models.</span>

<span class="sd">    Args:</span>
<span class="sd">        models: a list of models to register to the model server.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">models</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">at_least_one_model_ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">BaseKServeModel</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">ready</span><span class="p">:</span>
                    <span class="n">at_least_one_model_ready</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">register_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                    <span class="c1"># pass whether to log request latency into the model</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">enable_latency_logging</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_latency_logging</span>
                <span class="n">model</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Model type should be 'BaseKServeModel'"</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">at_least_one_model_ready</span> <span class="ow">and</span> <span class="n">models</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoModelReady</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">"Unknown model collection type"</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># formula as suggest in https://bugs.python.org/issue35279</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Setting max asyncio worker threads as </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">set_default_executor</span><span class="p">(</span>
        <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_asyncio_workers</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">servers_task</span><span class="p">():</span>
        <span class="n">servers</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_serve_rest</span><span class="p">()]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_grpc</span><span class="p">:</span>
            <span class="n">servers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_threads</span><span class="p">))</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">servers</span><span class="p">)</span>

    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">servers_task</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model_server.ModelServer.stop">
<code class="highlight language-python"><span class="n">stop</span><span class="p">(</span><span class="n">sig</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
<a class="headerlink" href="#kserve.model_server.ModelServer.stop" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Stop the instances of REST and gRPC model servers.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>sig</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[int]</code>
</td>
<td>
<div class="doc-md-description">
<p>The signal to stop the server. Default: <code>None</code>.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model_server.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Stop the instances of REST and gRPC model servers.</span>

<span class="sd">    Args:</span>
<span class="sd">        sig: The signal to stop the server. Default: ``None``.</span>
<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Stopping the model server"</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rest_server</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Stopping the rest server"</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rest_server</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Stopping the grpc server"</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_server</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span><span class="o">.</span><span class="n">get_models</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registered_models</span><span class="o">.</span><span class="n">unload</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<a id="kserve.model"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.model.BaseKServeModel">
<code>BaseKServeModel</code>
<a class="headerlink" href="#kserve.model.BaseKServeModel" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>
<p>A base class to inherit all of the kserve models from.</p>
<p>This class implements the expectations of model repository and model server.</p>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BaseKServeModel</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    A base class to inherit all of the kserve models from.</span>

<span class="sd">    This class implements the expectations of model repository and model server.</span>
<span class="sd">    """</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Adds the required attributes</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the model.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">healthy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Check the health of this model. By default returns `self.ready`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True if healthy, false otherwise</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Load handler can be overridden to load the model from storage.</span>
<span class="sd">        The `self.ready` should be set to True after the model is loaded. The flag is used for model health check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if model is ready, False otherwise</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Start handler can be overridden to perform model setup"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Stop handler can be overridden to perform model teardown"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.BaseKServeModel.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.model.BaseKServeModel.__init__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Adds the required attributes</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>name</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of the model.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Adds the required attributes</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the model.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.BaseKServeModel.healthy">
<code class="highlight language-python"><span class="n">healthy</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.model.BaseKServeModel.healthy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Check the health of this model. By default returns <code>self.ready</code>.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>True if healthy, false otherwise</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">healthy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Check the health of this model. By default returns `self.ready`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        True if healthy, false otherwise</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.BaseKServeModel.load">
<code class="highlight language-python"><span class="n">load</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.model.BaseKServeModel.load" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Load handler can be overridden to load the model from storage.
The <code>self.ready</code> should be set to True after the model is loaded. The flag is used for model health check.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>bool</code></td> <td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>True if model is ready, False otherwise</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Load handler can be overridden to load the model from storage.</span>
<span class="sd">    The `self.ready` should be set to True after the model is loaded. The flag is used for model health check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if model is ready, False otherwise</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.BaseKServeModel.start">
<code class="highlight language-python"><span class="n">start</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.model.BaseKServeModel.start" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Start handler can be overridden to perform model setup</p>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Start handler can be overridden to perform model setup"""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.BaseKServeModel.stop">
<code class="highlight language-python"><span class="n">stop</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.model.BaseKServeModel.stop" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Stop handler can be overridden to perform model teardown</p>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Stop handler can be overridden to perform model teardown"""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.model.InferenceModel">
<code>InferenceModel</code>
<a class="headerlink" href="#kserve.model.InferenceModel" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kserve.model.BaseKServeModel" href="#kserve.model.BaseKServeModel">BaseKServeModel</a></code></p>
<p>Abstract class representing a model that supports standard inference and prediction.</p>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InferenceModel</span><span class="p">(</span><span class="n">BaseKServeModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Abstract class representing a model that supports standard inference and prediction.</span>
<span class="sd">    """</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">CloudEvent</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">],</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verb</span><span class="p">:</span> <span class="n">InferenceVerb</span> <span class="o">=</span> <span class="n">InferenceVerb</span><span class="o">.</span><span class="n">PREDICT</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferReturnType</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_input_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="c1"># Override this function to return appropriate input format expected by your model.</span>
        <span class="c1"># Refer https://kserve.github.io/website/0.9/modelserving/inference_api/#model-metadata-response-json-object</span>

        <span class="c1"># Eg.</span>
        <span class="c1"># return [{ "name": "", "datatype": "INT32", "shape": [1,5], }]</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">get_output_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="c1"># Override this function to return appropriate output format returned by your model.</span>
        <span class="c1"># Refer https://kserve.github.io/website/0.9/modelserving/inference_api/#model-metadata-response-json-object</span>

        <span class="c1"># Eg.</span>
        <span class="c1"># return [{ "name": "", "datatype": "INT32", "shape": [1,5], }]</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.model.Model">
<code>Model</code>
<a class="headerlink" href="#kserve.model.Model" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="kserve.model.InferenceModel" href="#kserve.model.InferenceModel">InferenceModel</a></code></p>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">InferenceModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">predictor_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PredictorConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""KServe Model Public Interface</span>

<span class="sd">        Model is intended to be subclassed to implement the model handlers.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the model.</span>
<span class="sd">            predictor_config: The configurations for http call to the predictor.</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># The predictor config member fields are kept for backwards compatibility as they could be set outside</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">predictor_config</span><span class="o">.</span><span class="n">predictor_protocol</span>
            <span class="k">if</span> <span class="n">predictor_config</span>
            <span class="k">else</span> <span class="n">PredictorProtocol</span><span class="o">.</span><span class="n">REST_V1</span><span class="o">.</span><span class="n">value</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">predictor_config</span><span class="o">.</span><span class="n">predictor_host</span> <span class="k">if</span> <span class="n">predictor_config</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="c1"># The default timeout matches what is set in generated Istio virtual service resources.</span>
        <span class="c1"># We generally don't want things to time out at the request level here,</span>
        <span class="c1"># timeouts should be handled elsewhere in the system.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">predictor_config</span><span class="o">.</span><span class="n">predictor_request_timeout_seconds</span>
            <span class="k">if</span> <span class="n">predictor_config</span>
            <span class="k">else</span> <span class="mi">600</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span> <span class="o">=</span> <span class="n">predictor_config</span><span class="o">.</span><span class="n">predictor_use_ssl</span> <span class="k">if</span> <span class="n">predictor_config</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explainer_host</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http_client_instance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_client_stub</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_latency_logging</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">body</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">CloudEvent</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">],</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verb</span><span class="p">:</span> <span class="n">InferenceVerb</span> <span class="o">=</span> <span class="n">InferenceVerb</span><span class="o">.</span><span class="n">PREDICT</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferReturnType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Method to call predictor or explainer with the given input.</span>

<span class="sd">        Args:</span>
<span class="sd">            body: Request body.</span>
<span class="sd">            verb: The inference verb for predict/generate/explain</span>
<span class="sd">            headers: Request headers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Response output from preprocess -&gt; predict/generate/explain -&gt; postprocess</span>
<span class="sd">        """</span>
        <span class="n">request_id</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"x-request-id"</span><span class="p">,</span> <span class="s2">"N.A."</span><span class="p">)</span> <span class="k">if</span> <span class="n">headers</span> <span class="k">else</span> <span class="s2">"N.A."</span>

        <span class="c1"># latency vars</span>
        <span class="n">preprocess_ms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">explain_ms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">predict_ms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">postprocess_ms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">prom_labels</span> <span class="o">=</span> <span class="n">get_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">PRE_HIST_TIME</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="o">**</span><span class="n">prom_labels</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">)</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">preprocess_ms</span> <span class="o">=</span> <span class="n">get_latency_ms</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="n">InferenceVerb</span><span class="o">.</span><span class="n">EXPLAIN</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">EXPLAIN_HIST_TIME</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="o">**</span><span class="n">prom_labels</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explain</span><span class="p">)</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">explain_ms</span> <span class="o">=</span> <span class="n">get_latency_ms</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="k">elif</span> <span class="n">verb</span> <span class="o">==</span> <span class="n">InferenceVerb</span><span class="o">.</span><span class="n">PREDICT</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">PREDICT_HIST_TIME</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="o">**</span><span class="n">prom_labels</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">predict_ms</span> <span class="o">=</span> <span class="n">get_latency_ms</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

        <span class="k">with</span> <span class="n">POST_HIST_TIME</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="o">**</span><span class="n">prom_labels</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocess</span><span class="p">)</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">postprocess_ms</span> <span class="o">=</span> <span class="n">get_latency_ms</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_latency_logging</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">trace_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"requestId: </span><span class="si">{</span><span class="n">request_id</span><span class="si">}</span><span class="s2">, preprocess_ms: </span><span class="si">{</span><span class="n">preprocess_ms</span><span class="si">}</span><span class="s2">, "</span>
                <span class="sa">f</span><span class="s2">"explain_ms: </span><span class="si">{</span><span class="n">explain_ms</span><span class="si">}</span><span class="s2">, predict_ms: </span><span class="si">{</span><span class="n">predict_ms</span><span class="si">}</span><span class="s2">, "</span>
                <span class="sa">f</span><span class="s2">"postprocess_ms: </span><span class="si">{</span><span class="n">postprocess_ms</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_http_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferenceRESTClient</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_client_instance</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span><span class="p">:</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">RESTConfig</span><span class="p">(</span><span class="n">protocol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_http_client_instance</span> <span class="o">=</span> <span class="n">InferenceRESTClient</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_client_instance</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_grpc_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferenceGRPCClient</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_client_stub</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_client_stub</span> <span class="o">=</span> <span class="n">InferenceGRPCClient</span><span class="p">(</span>
                <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span><span class="p">,</span> <span class="n">use_ssl</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_client_stub</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ModelInferRequest</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">payload</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">payload</span>
        <span class="c1"># TODO: validate the request if self.get_input_types() defines the input types.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="n">PredictorProtocol</span><span class="o">.</span><span class="n">REST_V2</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">"inputs"</span> <span class="ow">in</span> <span class="n">payload</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="s2">"inputs"</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s1">'Expected "inputs" to be a list'</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="n">PredictorProtocol</span><span class="o">.</span><span class="n">REST_V1</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">Dict</span><span class="p">)</span>
                <span class="ow">and</span> <span class="s2">"instances"</span> <span class="ow">in</span> <span class="n">payload</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="s2">"instances"</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s1">'Expected "instances" to be a list'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">payload</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Load handler can be overridden to load the model from storage.</span>
<span class="sd">        The `self.ready` should be set to True after the model is loaded. The flag is used for model health check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if model is ready, False otherwise</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">],</span> <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""`preprocess` handler can be overridden for data or feature transformation.</span>
<span class="sd">        The model decodes the request body to `Dict` for v1 endpoints and `InferRequest` for v2 endpoints.</span>

<span class="sd">        Args:</span>
<span class="sd">            payload: Payload of the request.</span>
<span class="sd">            headers: Request headers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Dict or InferRequest in KServe Model Transformer mode which is transmitted on the wire to predictor.</span>
<span class="sd">            Tensors in KServe Predictor mode which is passed to predict handler for performing the inference.</span>
<span class="sd">        """</span>

        <span class="k">return</span> <span class="n">payload</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">postprocess</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferResponse</span><span class="p">],</span> <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferResponse</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""The `postprocess` handler can be overridden for inference result or response transformation.</span>
<span class="sd">        The predictor sends back the inference result in `Dict` for v1 endpoints and `InferResponse` for v2 endpoints.</span>

<span class="sd">        Args:</span>
<span class="sd">            result: The inference result passed from `predict` handler or the HTTP response from predictor.</span>
<span class="sd">            headers: Request headers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A Dict or InferResponse after post-process to return back to the client.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_http_predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">],</span> <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferResponse</span><span class="p">]:</span>
        <span class="c1"># Adjusting headers. Inject content type if not exist.</span>
        <span class="c1"># Also, removing host, as the header is the one passed to transformer and contains transformer's host</span>
        <span class="n">predict_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Content-Type"</span><span class="p">:</span> <span class="s2">"application/json"</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">"x-request-id"</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                <span class="n">predict_headers</span><span class="p">[</span><span class="s2">"x-request-id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">"x-request-id"</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">"x-b3-traceid"</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                <span class="n">predict_headers</span><span class="p">[</span><span class="s2">"x-b3-traceid"</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">"x-b3-traceid"</span><span class="p">]</span>

        <span class="n">protocol</span> <span class="o">=</span> <span class="s2">"https"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span> <span class="k">else</span> <span class="s2">"http"</span>
        <span class="n">predict_base_url</span> <span class="o">=</span> <span class="n">PREDICTOR_BASE_URL_FORMAT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
            <span class="n">predict_base_url</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">predict_headers</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_grpc_predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ModelInferRequest</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">],</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferResponse</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">ModelInferRequest</span><span class="p">):</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="n">InferRequest</span><span class="o">.</span><span class="n">from_grpc</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">async_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_client</span><span class="o">.</span><span class="n">infer</span><span class="p">(</span>
            <span class="n">infer_request</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">"request_type"</span><span class="p">,</span> <span class="s2">"grpc_v2"</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">"response_type"</span><span class="p">,</span> <span class="s2">"grpc_v2"</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">"x-request-id"</span><span class="p">,</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"x-request-id"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)),</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">async_result</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">,</span> <span class="n">ModelInferRequest</span><span class="p">],</span>
        <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferResponse</span><span class="p">,</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""The `predict` handler can be overridden for performing the inference.</span>
<span class="sd">            By default, the predict handler makes call to predictor for the inference step.</span>

<span class="sd">        Args:</span>
<span class="sd">            payload: Model inputs passed from `preprocess` handler.</span>
<span class="sd">            headers: Request headers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Inference result or a Response from the predictor.</span>

<span class="sd">        Raises:</span>
<span class="sd">            HTTPStatusError when getting back an error response from the predictor.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Could not find predictor_host."</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="n">PredictorProtocol</span><span class="o">.</span><span class="n">GRPC_V2</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_predict</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_predict</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""`explain` handler can be overridden to implement the model explanation.</span>
<span class="sd">        The default implementation makes call to the explainer if ``explainer_host`` is specified.</span>

<span class="sd">        Args:</span>
<span class="sd">            payload: Explainer model inputs passed from preprocess handler.</span>
<span class="sd">            headers: Request headers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An Explanation for the inference result.</span>

<span class="sd">        Raises:</span>
<span class="sd">            HTTPStatusError when getting back an error response from the explainer.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">explainer_host</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Could not find explainer_host."</span><span class="p">)</span>

        <span class="n">explain_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"content-type"</span><span class="p">:</span> <span class="s2">"application/json"</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">"content-type"</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                <span class="n">explain_headers</span><span class="p">[</span><span class="s2">"content-type"</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">"content-type"</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">"x-request-id"</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                <span class="n">explain_headers</span><span class="p">[</span><span class="s2">"x-request-id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">"x-request-id"</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">"x-b3-traceid"</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                <span class="n">explain_headers</span><span class="p">[</span><span class="s2">"x-b3-traceid"</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">"x-b3-traceid"</span><span class="p">]</span>

        <span class="n">protocol</span> <span class="o">=</span> <span class="s2">"https"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span> <span class="k">else</span> <span class="s2">"http"</span>
        <span class="c1"># Currently explainer only supports the kserve v1 endpoints</span>
        <span class="n">explain_base_url</span> <span class="o">=</span> <span class="n">EXPLAINER_BASE_URL_FORMAT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">explainer_host</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span>
            <span class="n">explain_base_url</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">explain_headers</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.Model.__call__">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="n">InferenceVerb</span><span class="o">.</span><span class="n">PREDICT</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
<a class="headerlink" href="#kserve.model.Model.__call__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Method to call predictor or explainer with the given input.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>body</code></td>
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="cloudevents.http.CloudEvent">CloudEvent</span>, <a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferRequest" href="#kserve.protocol.infer_type.InferRequest">InferRequest</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Request body.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>verb</code></td>
<td>
<code><span title="kserve.model.InferenceVerb">InferenceVerb</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The inference verb for predict/generate/explain</p>
</div>
</td>
<td>
<code><span title="kserve.model.InferenceVerb.PREDICT">PREDICT</span></code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>headers</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[str, str]]</code>
</td>
<td>
<div class="doc-md-description">
<p>Request headers.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="kserve.model.InferReturnType">InferReturnType</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Response output from preprocess -&gt; predict/generate/explain -&gt; postprocess</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">body</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">CloudEvent</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">],</span>
    <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">verb</span><span class="p">:</span> <span class="n">InferenceVerb</span> <span class="o">=</span> <span class="n">InferenceVerb</span><span class="o">.</span><span class="n">PREDICT</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InferReturnType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Method to call predictor or explainer with the given input.</span>

<span class="sd">    Args:</span>
<span class="sd">        body: Request body.</span>
<span class="sd">        verb: The inference verb for predict/generate/explain</span>
<span class="sd">        headers: Request headers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Response output from preprocess -&gt; predict/generate/explain -&gt; postprocess</span>
<span class="sd">    """</span>
    <span class="n">request_id</span> <span class="o">=</span> <span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"x-request-id"</span><span class="p">,</span> <span class="s2">"N.A."</span><span class="p">)</span> <span class="k">if</span> <span class="n">headers</span> <span class="k">else</span> <span class="s2">"N.A."</span>

    <span class="c1"># latency vars</span>
    <span class="n">preprocess_ms</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">explain_ms</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">predict_ms</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">postprocess_ms</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">prom_labels</span> <span class="o">=</span> <span class="n">get_labels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">PRE_HIST_TIME</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="o">**</span><span class="n">prom_labels</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">)</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">preprocess_ms</span> <span class="o">=</span> <span class="n">get_latency_ms</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="n">InferenceVerb</span><span class="o">.</span><span class="n">EXPLAIN</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">EXPLAIN_HIST_TIME</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="o">**</span><span class="n">prom_labels</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explain</span><span class="p">)</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">explain_ms</span> <span class="o">=</span> <span class="n">get_latency_ms</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">verb</span> <span class="o">==</span> <span class="n">InferenceVerb</span><span class="o">.</span><span class="n">PREDICT</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">PREDICT_HIST_TIME</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="o">**</span><span class="n">prom_labels</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">)</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">predict_ms</span> <span class="o">=</span> <span class="n">get_latency_ms</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">with</span> <span class="n">POST_HIST_TIME</span><span class="o">.</span><span class="n">labels</span><span class="p">(</span><span class="o">**</span><span class="n">prom_labels</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">():</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="p">(</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">postprocess</span><span class="p">)</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">postprocess</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">postprocess_ms</span> <span class="o">=</span> <span class="n">get_latency_ms</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_latency_logging</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">trace_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"requestId: </span><span class="si">{</span><span class="n">request_id</span><span class="si">}</span><span class="s2">, preprocess_ms: </span><span class="si">{</span><span class="n">preprocess_ms</span><span class="si">}</span><span class="s2">, "</span>
            <span class="sa">f</span><span class="s2">"explain_ms: </span><span class="si">{</span><span class="n">explain_ms</span><span class="si">}</span><span class="s2">, predict_ms: </span><span class="si">{</span><span class="n">predict_ms</span><span class="si">}</span><span class="s2">, "</span>
            <span class="sa">f</span><span class="s2">"postprocess_ms: </span><span class="si">{</span><span class="n">postprocess_ms</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.Model.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">predictor_config</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.model.Model.__init__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>KServe Model Public Interface</p>
<p>Model is intended to be subclassed to implement the model handlers.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>name</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of the model.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>predictor_config</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="kserve.model.PredictorConfig" href="#kserve.model.PredictorConfig">PredictorConfig</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>The configurations for http call to the predictor.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">predictor_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PredictorConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""KServe Model Public Interface</span>

<span class="sd">    Model is intended to be subclassed to implement the model handlers.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the model.</span>
<span class="sd">        predictor_config: The configurations for http call to the predictor.</span>
<span class="sd">    """</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># The predictor config member fields are kept for backwards compatibility as they could be set outside</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">predictor_config</span><span class="o">.</span><span class="n">predictor_protocol</span>
        <span class="k">if</span> <span class="n">predictor_config</span>
        <span class="k">else</span> <span class="n">PredictorProtocol</span><span class="o">.</span><span class="n">REST_V1</span><span class="o">.</span><span class="n">value</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">predictor_config</span><span class="o">.</span><span class="n">predictor_host</span> <span class="k">if</span> <span class="n">predictor_config</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="c1"># The default timeout matches what is set in generated Istio virtual service resources.</span>
    <span class="c1"># We generally don't want things to time out at the request level here,</span>
    <span class="c1"># timeouts should be handled elsewhere in the system.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">predictor_config</span><span class="o">.</span><span class="n">predictor_request_timeout_seconds</span>
        <span class="k">if</span> <span class="n">predictor_config</span>
        <span class="k">else</span> <span class="mi">600</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span> <span class="o">=</span> <span class="n">predictor_config</span><span class="o">.</span><span class="n">predictor_use_ssl</span> <span class="k">if</span> <span class="n">predictor_config</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">explainer_host</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_http_client_instance</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_client_stub</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">enable_latency_logging</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.Model.explain">
<code class="highlight language-python"><span class="n">explain</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
<a class="headerlink" href="#kserve.model.Model.explain" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p><code>explain</code> handler can be overridden to implement the model explanation.
The default implementation makes call to the explainer if <code>explainer_host</code> is specified.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>payload</code></td>
<td>
<code><span title="typing.Dict">Dict</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Explainer model inputs passed from preprocess handler.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>headers</code></td>
<td>
<code><span title="typing.Dict">Dict</span>[str, str]</code>
</td>
<td>
<div class="doc-md-description">
<p>Request headers.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Dict">Dict</span></code>
</td>
<td>
<div class="doc-md-description">
<p>An Explanation for the inference result.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""`explain` handler can be overridden to implement the model explanation.</span>
<span class="sd">    The default implementation makes call to the explainer if ``explainer_host`` is specified.</span>

<span class="sd">    Args:</span>
<span class="sd">        payload: Explainer model inputs passed from preprocess handler.</span>
<span class="sd">        headers: Request headers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        An Explanation for the inference result.</span>

<span class="sd">    Raises:</span>
<span class="sd">        HTTPStatusError when getting back an error response from the explainer.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">explainer_host</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Could not find explainer_host."</span><span class="p">)</span>

    <span class="n">explain_headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"content-type"</span><span class="p">:</span> <span class="s2">"application/json"</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">"content-type"</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="n">explain_headers</span><span class="p">[</span><span class="s2">"content-type"</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">"content-type"</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">"x-request-id"</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="n">explain_headers</span><span class="p">[</span><span class="s2">"x-request-id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">"x-request-id"</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">"x-b3-traceid"</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
            <span class="n">explain_headers</span><span class="p">[</span><span class="s2">"x-b3-traceid"</span><span class="p">]</span> <span class="o">=</span> <span class="n">headers</span><span class="p">[</span><span class="s2">"x-b3-traceid"</span><span class="p">]</span>

    <span class="n">protocol</span> <span class="o">=</span> <span class="s2">"https"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span> <span class="k">else</span> <span class="s2">"http"</span>
    <span class="c1"># Currently explainer only supports the kserve v1 endpoints</span>
    <span class="n">explain_base_url</span> <span class="o">=</span> <span class="n">EXPLAINER_BASE_URL_FORMAT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">protocol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">explainer_host</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_client</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span>
        <span class="n">explain_base_url</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="n">explain_headers</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.Model.load">
<code class="highlight language-python"><span class="n">load</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.model.Model.load" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Load handler can be overridden to load the model from storage.
The <code>self.ready</code> should be set to True after the model is loaded. The flag is used for model health check.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>bool</code></td> <td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>True if model is ready, False otherwise</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Load handler can be overridden to load the model from storage.</span>
<span class="sd">    The `self.ready` should be set to True after the model is loaded. The flag is used for model health check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if model is ready, False otherwise</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.Model.postprocess">
<code class="highlight language-python"><span class="n">postprocess</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
<a class="headerlink" href="#kserve.model.Model.postprocess" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The <code>postprocess</code> handler can be overridden for inference result or response transformation.
The predictor sends back the inference result in <code>Dict</code> for v1 endpoints and <code>InferResponse</code> for v2 endpoints.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>result</code></td>
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferResponse" href="#kserve.protocol.infer_type.InferResponse">InferResponse</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>The inference result passed from <code>predict</code> handler or the HTTP response from predictor.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>headers</code></td>
<td>
<code><span title="typing.Dict">Dict</span>[str, str]</code>
</td>
<td>
<div class="doc-md-description">
<p>Request headers.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferResponse" href="#kserve.protocol.infer_type.InferResponse">InferResponse</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>A Dict or InferResponse after post-process to return back to the client.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">postprocess</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferResponse</span><span class="p">],</span> <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""The `postprocess` handler can be overridden for inference result or response transformation.</span>
<span class="sd">    The predictor sends back the inference result in `Dict` for v1 endpoints and `InferResponse` for v2 endpoints.</span>

<span class="sd">    Args:</span>
<span class="sd">        result: The inference result passed from `predict` handler or the HTTP response from predictor.</span>
<span class="sd">        headers: Request headers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Dict or InferResponse after post-process to return back to the client.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.Model.predict">
<code class="highlight language-python"><span class="n">predict</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
<a class="headerlink" href="#kserve.model.Model.predict" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The <code>predict</code> handler can be overridden for performing the inference.
    By default, the predict handler makes call to predictor for the inference step.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>payload</code></td>
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferRequest" href="#kserve.protocol.infer_type.InferRequest">InferRequest</a>, <span title="kserve.protocol.grpc.grpc_predict_v2_pb2.ModelInferRequest">ModelInferRequest</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Model inputs passed from <code>preprocess</code> handler.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>headers</code></td>
<td>
<code><span title="typing.Dict">Dict</span>[str, str]</code>
</td>
<td>
<div class="doc-md-description">
<p>Request headers.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferResponse" href="#kserve.protocol.infer_type.InferResponse">InferResponse</a>, <span title="typing.AsyncIterator">AsyncIterator</span>[<span title="typing.Any">Any</span>]]</code>
</td>
<td>
<div class="doc-md-description">
<p>Inference result or a Response from the predictor.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">,</span> <span class="n">ModelInferRequest</span><span class="p">],</span>
    <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferResponse</span><span class="p">,</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">"""The `predict` handler can be overridden for performing the inference.</span>
<span class="sd">        By default, the predict handler makes call to predictor for the inference step.</span>

<span class="sd">    Args:</span>
<span class="sd">        payload: Model inputs passed from `preprocess` handler.</span>
<span class="sd">        headers: Request headers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Inference result or a Response from the predictor.</span>

<span class="sd">    Raises:</span>
<span class="sd">        HTTPStatusError when getting back an error response from the predictor.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">"Could not find predictor_host."</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">==</span> <span class="n">PredictorProtocol</span><span class="o">.</span><span class="n">GRPC_V2</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grpc_predict</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http_predict</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.Model.preprocess">
<code class="highlight language-python"><span class="n">preprocess</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-async"><code>async</code></small>
</span>
<a class="headerlink" href="#kserve.model.Model.preprocess" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p><code>preprocess</code> handler can be overridden for data or feature transformation.
The model decodes the request body to <code>Dict</code> for v1 endpoints and <code>InferRequest</code> for v2 endpoints.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>payload</code></td>
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferRequest" href="#kserve.protocol.infer_type.InferRequest">InferRequest</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Payload of the request.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>headers</code></td>
<td>
<code><span title="typing.Dict">Dict</span>[str, str]</code>
</td>
<td>
<div class="doc-md-description">
<p>Request headers.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferRequest" href="#kserve.protocol.infer_type.InferRequest">InferRequest</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>A Dict or InferRequest in KServe Model Transformer mode which is transmitted on the wire to predictor.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferRequest" href="#kserve.protocol.infer_type.InferRequest">InferRequest</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Tensors in KServe Predictor mode which is passed to predict handler for performing the inference.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">],</span> <span class="n">headers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""`preprocess` handler can be overridden for data or feature transformation.</span>
<span class="sd">    The model decodes the request body to `Dict` for v1 endpoints and `InferRequest` for v2 endpoints.</span>

<span class="sd">    Args:</span>
<span class="sd">        payload: Payload of the request.</span>
<span class="sd">        headers: Request headers.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A Dict or InferRequest in KServe Model Transformer mode which is transmitted on the wire to predictor.</span>
<span class="sd">        Tensors in KServe Predictor mode which is passed to predict handler for performing the inference.</span>
<span class="sd">    """</span>

    <span class="k">return</span> <span class="n">payload</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.model.PredictorConfig">
<code>PredictorConfig</code>
<a class="headerlink" href="#kserve.model.PredictorConfig" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PredictorConfig</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">predictor_host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">predictor_protocol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">PredictorProtocol</span><span class="o">.</span><span class="n">REST_V1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">predictor_use_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">predictor_request_timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""The configuration for the http call to the predictor</span>

<span class="sd">        Args:</span>
<span class="sd">            predictor_host: The host name of the predictor</span>
<span class="sd">            predictor_protocol: The inference protocol used for predictor http call</span>
<span class="sd">            predictor_use_ssl: Enable using ssl for http connection to the predictor</span>
<span class="sd">            predictor_request_timeout_seconds: The request timeout seconds for the predictor http call</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span> <span class="o">=</span> <span class="n">predictor_host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor_protocol</span> <span class="o">=</span> <span class="n">predictor_protocol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor_use_ssl</span> <span class="o">=</span> <span class="n">predictor_use_ssl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predictor_request_timeout_seconds</span> <span class="o">=</span> <span class="n">predictor_request_timeout_seconds</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.model.PredictorConfig.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">predictor_host</span><span class="p">,</span> <span class="n">predictor_protocol</span><span class="o">=</span><span class="n">PredictorProtocol</span><span class="o">.</span><span class="n">REST_V1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">predictor_use_ssl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">predictor_request_timeout_seconds</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.model.PredictorConfig.__init__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The configuration for the http call to the predictor</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>predictor_host</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The host name of the predictor</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>predictor_protocol</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The inference protocol used for predictor http call</p>
</div>
</td>
<td>
<code><span title="kserve.constants.constants.PredictorProtocol.REST_V1">REST_V1</span>.value</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>predictor_use_ssl</code></td>
<td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>Enable using ssl for http connection to the predictor</p>
</div>
</td>
<td>
<code>False</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>predictor_request_timeout_seconds</code></td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>The request timeout seconds for the predictor http call</p>
</div>
</td>
<td>
<code>600</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/model.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">predictor_host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">predictor_protocol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">PredictorProtocol</span><span class="o">.</span><span class="n">REST_V1</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">predictor_use_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">predictor_request_timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""The configuration for the http call to the predictor</span>

<span class="sd">    Args:</span>
<span class="sd">        predictor_host: The host name of the predictor</span>
<span class="sd">        predictor_protocol: The inference protocol used for predictor http call</span>
<span class="sd">        predictor_use_ssl: Enable using ssl for http connection to the predictor</span>
<span class="sd">        predictor_request_timeout_seconds: The request timeout seconds for the predictor http call</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictor_host</span> <span class="o">=</span> <span class="n">predictor_host</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictor_protocol</span> <span class="o">=</span> <span class="n">predictor_protocol</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictor_use_ssl</span> <span class="o">=</span> <span class="n">predictor_use_ssl</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predictor_request_timeout_seconds</span> <span class="o">=</span> <span class="n">predictor_request_timeout_seconds</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-module">
<a id="kserve.protocol.infer_type"></a>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput">
<code>InferInput</code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InferInput</span><span class="p">:</span>
    <span class="n">_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_shape</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">_datatype</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">_parameters</span><span class="p">:</span> <span class="n">Dict</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">shape</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">datatype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">InferTensorContents</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""An object of InferInput class is used to describe the input tensor of an inference request.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: The name of the inference input whose data will be described by this object.</span>
<span class="sd">            shape : The shape of the associated inference input.</span>
<span class="sd">            datatype : The data type of the associated inference input.</span>
<span class="sd">            data : The data of the inference input.</span>
<span class="sd">                   When data is not set, raw_data is used for gRPC to transmit with numpy array bytes</span>
<span class="sd">                   by using `set_data_from_numpy`.</span>
<span class="sd">            parameters : The additional inference parameters.</span>
<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Get the name of inference input associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The name of the inference input</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">datatype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Get the datatype of inference input associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The datatype of the inference input.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">InferTensorContents</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get the data of the inference input associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The data of the inference input.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Set the data of the inference input associated with this object.</span>

<span class="sd">        Args:</span>
<span class="sd">             data: data of the inference input.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get the shape of inference input associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The shape of the inference input.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get the parameters of the inference input associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The additional inference parameters</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Set the parameters of the inference input associated with this object.</span>

<span class="sd">        Args:</span>
<span class="sd">             params: parameters of the inference input</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">params</span>

    <span class="nd">@shape</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">"""Set the shape of inference input.</span>

<span class="sd">        Args:</span>
<span class="sd">            shape : The shape of the associated inference input.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="n">shape</span>

    <span class="k">def</span> <span class="nf">as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Decodes the inference input data as a list of strings.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[List[str]]: The decoded data as a list of strings.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidInput: If the datatype of the inference input is not 'BYTES'.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">li</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="sa">f</span><span class="s2">"invalid datatype </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="si">}</span><span class="s2"> in the input"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Decode the inference input data as numpy array.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A numpy array of the inference input data</span>
<span class="sd">        Raises:</span>
<span class="sd">            InvalidInput: If the datatype of the inference input is not recognized.</span>
<span class="sd">        """</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">to_np_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="sa">f</span><span class="s2">"invalid datatype </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> in the input"</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
                <span class="c1"># String results contain a 4-byte string length</span>
                <span class="c1"># followed by the actual string characters. Hence,</span>
                <span class="c1"># need to decode the raw bytes to convert into</span>
                <span class="c1"># array elements.</span>
                <span class="n">np_array</span> <span class="o">=</span> <span class="n">deserialize_bytes_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">np_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">np_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_data_from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_tensor</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">binary_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Set the tensor data from the specified numpy array for input associated with this object.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_tensor : The tensor data in numpy array format.</span>
<span class="sd">            binary_data : Indicates whether to set data for the input in binary format</span>
<span class="sd">                          or explicit tensor within JSON. The default value is True,</span>
<span class="sd">                          which means the data will be delivered as binary data with gRPC or in the</span>
<span class="sd">                          HTTP body after the JSON object for REST.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InferenceError if failed to set data for the tensor.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,)):</span>
            <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span><span class="s2">"input_tensor must be a numpy array"</span><span class="p">)</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="n">from_np_dtype</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">!=</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
                <span class="s2">"got unexpected datatype </span><span class="si">{}</span><span class="s2"> from numpy array, expected </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
                <span class="s2">"got unexpected numpy array shape [</span><span class="si">{}</span><span class="s2">], expected [</span><span class="si">{}</span><span class="s2">]"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">binary_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"binary_data_size"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span>
                            <span class="n">input_tensor</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s2">"refs_ok"</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">"C"</span>
                        <span class="p">):</span>
                            <span class="c1"># We need to convert the object to string using utf-8,</span>
                            <span class="c1"># if we want to use the binary_data=False. JSON requires</span>
                            <span class="c1"># the input to be a UTF-8 string.</span>
                            <span class="k">if</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">'Failed to encode "</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s1">" using UTF-8. Please use binary_data=True, if'</span>
                        <span class="s2">" you want to pass a byte array."</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
                <span class="n">serialized_output</span> <span class="o">=</span> <span class="n">serialize_byte_tensor</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">serialized_output</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">serialized_output</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"binary_data_size"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="s2">"binary_data_size"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">InferInput</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">datatype</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">"shape"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="s2">"datatype"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
            <span class="s2">"data"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="s2">"parameters"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">'"name": "</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">",'</span>
            <span class="sa">f</span><span class="s1">'"shape": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">,'</span>
            <span class="sa">f</span><span class="s1">'"datatype": "</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="si">}</span><span class="s1">",'</span>
            <span class="sa">f</span><span class="s1">'"data": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s1">,'</span>
            <span class="sa">f</span><span class="s1">'"parameters": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="si">}</span><span class="s1">'</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput.data">
<code class="highlight language-python"><span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">InferTensorContents</span><span class="p">]</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
<small class="doc doc-label doc-label-writable"><code>writable</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput.data" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the data of the inference input associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>, <span title="numpy.ndarray">ndarray</span>, <span title="kserve.protocol.grpc.grpc_predict_v2_pb2.InferTensorContents">InferTensorContents</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>The data of the inference input.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput.datatype">
<code class="highlight language-python"><span class="n">datatype</span><span class="p">:</span> <span class="nb">str</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput.datatype" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the datatype of inference input associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The datatype of the inference input.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput.name">
<code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput.name" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the name of inference input associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of the inference input</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput.parameters">
<code class="highlight language-python"><span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
<small class="doc doc-label doc-label-writable"><code>writable</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput.parameters" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the parameters of the inference input associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="google.protobuf.internal.containers.MessageMap">MessageMap</span>[str, <span title="kserve.protocol.grpc.grpc_predict_v2_pb2.InferParameter">InferParameter</span>], None]</code>
</td>
<td>
<div class="doc-md-description">
<p>The additional inference parameters</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput.shape">
<code class="highlight language-python"><span class="n">shape</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
<small class="doc doc-label doc-label-writable"><code>writable</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput.shape" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the shape of inference input associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[int]</code>
</td>
<td>
<div class="doc-md-description">
<p>The shape of the inference input.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput.__init__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An object of InferInput class is used to describe the input tensor of an inference request.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>name</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of the inference input whose data will be described by this object.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>shape</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The shape of the associated inference input.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>datatype</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The data type of the associated inference input.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>data</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The data of the inference input.
   When data is not set, raw_data is used for gRPC to transmit with numpy array bytes
   by using <code>set_data_from_numpy</code>.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>parameters</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The additional inference parameters.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">shape</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">datatype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">InferTensorContents</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""An object of InferInput class is used to describe the input tensor of an inference request.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: The name of the inference input whose data will be described by this object.</span>
<span class="sd">        shape : The shape of the associated inference input.</span>
<span class="sd">        datatype : The data type of the associated inference input.</span>
<span class="sd">        data : The data of the inference input.</span>
<span class="sd">               When data is not set, raw_data is used for gRPC to transmit with numpy array bytes</span>
<span class="sd">               by using `set_data_from_numpy`.</span>
<span class="sd">        parameters : The additional inference parameters.</span>
<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="n">shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput.as_numpy">
<code class="highlight language-python"><span class="n">as_numpy</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput.as_numpy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decode the inference input data as numpy array.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="numpy.ndarray">ndarray</span></code>
</td>
<td>
<div class="doc-md-description">
<p>A numpy array of the inference input data</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">as_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Decode the inference input data as numpy array.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A numpy array of the inference input data</span>
<span class="sd">    Raises:</span>
<span class="sd">        InvalidInput: If the datatype of the inference input is not recognized.</span>
<span class="sd">    """</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">to_np_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="sa">f</span><span class="s2">"invalid datatype </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> in the input"</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
            <span class="c1"># String results contain a 4-byte string length</span>
            <span class="c1"># followed by the actual string characters. Hence,</span>
            <span class="c1"># need to decode the raw bytes to convert into</span>
            <span class="c1"># array elements.</span>
            <span class="n">np_array</span> <span class="o">=</span> <span class="n">deserialize_bytes_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">np_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">np_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput.as_string">
<code class="highlight language-python"><span class="n">as_string</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput.as_string" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decodes the inference input data as a list of strings.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[<span title="typing.List">List</span>[str]]</code>
</td>
<td>
<div class="doc-md-description">
<p>List[List[str]]: The decoded data as a list of strings.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="kserve.errors.InvalidInput">InvalidInput</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the datatype of the inference input is not 'BYTES'.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">as_string</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Decodes the inference input data as a list of strings.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[List[str]]: The decoded data as a list of strings.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InvalidInput: If the datatype of the inference input is not 'BYTES'.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">li</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="sa">f</span><span class="s2">"invalid datatype </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="si">}</span><span class="s2"> in the input"</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferInput.set_data_from_numpy">
<code class="highlight language-python"><span class="n">set_data_from_numpy</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferInput.set_data_from_numpy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Set the tensor data from the specified numpy array for input associated with this object.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>input_tensor</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The tensor data in numpy array format.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>binary_data</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>Indicates whether to set data for the input in binary format
          or explicit tensor within JSON. The default value is True,
          which means the data will be delivered as binary data with gRPC or in the
          HTTP body after the JSON object for REST.</p>
</div>
</td>
<td>
<code>True</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_data_from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_tensor</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">binary_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Set the tensor data from the specified numpy array for input associated with this object.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_tensor : The tensor data in numpy array format.</span>
<span class="sd">        binary_data : Indicates whether to set data for the input in binary format</span>
<span class="sd">                      or explicit tensor within JSON. The default value is True,</span>
<span class="sd">                      which means the data will be delivered as binary data with gRPC or in the</span>
<span class="sd">                      HTTP body after the JSON object for REST.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InferenceError if failed to set data for the tensor.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,)):</span>
        <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span><span class="s2">"input_tensor must be a numpy array"</span><span class="p">)</span>

    <span class="n">dtype</span> <span class="o">=</span> <span class="n">from_np_dtype</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">!=</span> <span class="n">dtype</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
            <span class="s2">"got unexpected datatype </span><span class="si">{}</span><span class="s2"> from numpy array, expected </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
        <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
            <span class="s2">"got unexpected numpy array shape [</span><span class="si">{}</span><span class="s2">], expected [</span><span class="si">{}</span><span class="s2">]"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">binary_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"binary_data_size"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span>
                        <span class="n">input_tensor</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s2">"refs_ok"</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">"C"</span>
                    <span class="p">):</span>
                        <span class="c1"># We need to convert the object to string using utf-8,</span>
                        <span class="c1"># if we want to use the binary_data=False. JSON requires</span>
                        <span class="c1"># the input to be a UTF-8 string.</span>
                        <span class="k">if</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'Failed to encode "</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s1">" using UTF-8. Please use binary_data=True, if'</span>
                    <span class="s2">" you want to pass a byte array."</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
            <span class="n">serialized_output</span> <span class="o">=</span> <span class="n">serialize_byte_tensor</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">serialized_output</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">serialized_output</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"binary_data_size"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="s2">"binary_data_size"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.protocol.infer_type.InferOutput">
<code>InferOutput</code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferOutput" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InferOutput</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">shape</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">datatype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">InferTensorContents</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""An object of InferOutput class is used to describe the output tensor for an inference response.</span>

<span class="sd">        Args:</span>
<span class="sd">            name : The name of inference output whose data will be described by this object.</span>
<span class="sd">            shape : The shape of the associated inference output.</span>
<span class="sd">            datatype : The data type of the associated inference output.</span>
<span class="sd">            data : The data of the inference output. When data is not set,</span>
<span class="sd">                   raw_data is used for gRPC with numpy array bytes by calling set_data_from_numpy.</span>
<span class="sd">            parameters : The additional inference parameters.</span>
<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Get the name of inference output associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The name of inference output.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">datatype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Get the data type of inference output associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The data type of inference output.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">InferTensorContents</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get the data of inference output associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The data of inference output.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@data</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">InferTensorContents</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">"""Set the data of inference output associated with this object.</span>

<span class="sd">        Args:</span>
<span class="sd">            data: inference output data.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get the shape of inference output associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The shape of inference output</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span>

    <span class="nd">@shape</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">"""Set the shape of inference output.</span>

<span class="sd">        Args:</span>
<span class="sd">            shape: The shape of the associated inference output.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="n">shape</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get the parameters of inference output associated with this object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The additional inference parameters associated with the inference output.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]):</span>
<span class="w">        </span><span class="sd">"""Set the parameters of inference output associated with this object.</span>

<span class="sd">        :param params: The parameters of inference output</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">params</span>

    <span class="k">def</span> <span class="nf">as_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Decode the tensor output data as numpy array.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The numpy array of the associated inference output data.</span>
<span class="sd">        """</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">to_np_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"invalid datatype in the input"</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
                <span class="c1"># String results contain a 4-byte string length</span>
                <span class="c1"># followed by the actual string characters. Hence,</span>
                <span class="c1"># need to decode the raw bytes to convert into</span>
                <span class="c1"># array elements.</span>
                <span class="n">np_array</span> <span class="o">=</span> <span class="n">deserialize_bytes_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">np_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">np_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_data_from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_tensor</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">binary_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Set the tensor data from the specified numpy array for the inference output associated with this object.</span>

<span class="sd">        Args:</span>
<span class="sd">            output_tensor : The tensor data in numpy array format.</span>
<span class="sd">            binary_data : Indicates whether to set data for the input in binary format</span>
<span class="sd">                          or explicit tensor within JSON. The default value is True,</span>
<span class="sd">                          which means the data will be delivered as binary data with gRPC or in the</span>
<span class="sd">                          HTTP body after the JSON object for REST.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InferenceError if failed to set data for the output tensor.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_tensor</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,)):</span>
            <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span><span class="s2">"input_tensor must be a numpy array"</span><span class="p">)</span>

        <span class="n">dtype</span> <span class="o">=</span> <span class="n">from_np_dtype</span><span class="p">(</span><span class="n">output_tensor</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">!=</span> <span class="n">dtype</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
                <span class="s2">"got unexpected datatype </span><span class="si">{}</span><span class="s2"> from numpy array, expected </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
                <span class="s2">"got unexpected numpy array shape [</span><span class="si">{}</span><span class="s2">], expected [</span><span class="si">{}</span><span class="s2">]"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">output_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">binary_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"binary_data_size"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span>
                            <span class="n">output_tensor</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s2">"refs_ok"</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">"C"</span>
                        <span class="p">):</span>
                            <span class="c1"># We need to convert the object to string using utf-8,</span>
                            <span class="c1"># if we want to use the binary_data=False. JSON requires</span>
                            <span class="c1"># the input to be a UTF-8 string.</span>
                            <span class="k">if</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s1">'Failed to encode "</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s1">" using UTF-8. Please use binary_data=True, if'</span>
                        <span class="s2">" you want to pass a byte array."</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
                <span class="n">serialized_output</span> <span class="o">=</span> <span class="n">serialize_byte_tensor</span><span class="p">(</span><span class="n">output_tensor</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">serialized_output</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">serialized_output</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"binary_data_size"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="s2">"binary_data_size"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">InferOutput</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">datatype</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">"shape"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="s2">"datatype"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
            <span class="s2">"data"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="s2">"parameters"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">'"name": "</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">",'</span>
            <span class="sa">f</span><span class="s1">'"shape": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">,'</span>
            <span class="sa">f</span><span class="s1">'"datatype": "</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="si">}</span><span class="s1">",'</span>
            <span class="sa">f</span><span class="s1">'"data": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="si">}</span><span class="s1">,'</span>
            <span class="sa">f</span><span class="s1">'"parameters": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="si">}</span><span class="s1">'</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferOutput.data">
<code class="highlight language-python"><span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">InferTensorContents</span><span class="p">]</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
<small class="doc doc-label doc-label-writable"><code>writable</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferOutput.data" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the data of inference output associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>, <span title="numpy.ndarray">ndarray</span>, <span title="kserve.protocol.grpc.grpc_predict_v2_pb2.InferTensorContents">InferTensorContents</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>The data of inference output.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferOutput.datatype">
<code class="highlight language-python"><span class="n">datatype</span><span class="p">:</span> <span class="nb">str</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferOutput.datatype" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the data type of inference output associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The data type of inference output.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferOutput.name">
<code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferOutput.name" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the name of inference output associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of inference output.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferOutput.parameters">
<code class="highlight language-python"><span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
<small class="doc doc-label doc-label-writable"><code>writable</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferOutput.parameters" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the parameters of inference output associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="google.protobuf.internal.containers.MessageMap">MessageMap</span>[str, <span title="kserve.protocol.grpc.grpc_predict_v2_pb2.InferParameter">InferParameter</span>], None]</code>
</td>
<td>
<div class="doc-md-description">
<p>The additional inference parameters associated with the inference output.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferOutput.shape">
<code class="highlight language-python"><span class="n">shape</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
<small class="doc doc-label doc-label-writable"><code>writable</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferOutput.shape" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the shape of inference output associated with this object.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.List">List</span>[int]</code>
</td>
<td>
<div class="doc-md-description">
<p>The shape of inference output</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferOutput.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">datatype</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferOutput.__init__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>An object of InferOutput class is used to describe the output tensor for an inference response.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>name</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The name of inference output whose data will be described by this object.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>shape</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The shape of the associated inference output.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>datatype</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The data type of the associated inference output.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>data</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The data of the inference output. When data is not set,
   raw_data is used for gRPC with numpy array bytes by calling set_data_from_numpy.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>parameters</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The additional inference parameters.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">shape</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">datatype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">InferTensorContents</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""An object of InferOutput class is used to describe the output tensor for an inference response.</span>

<span class="sd">    Args:</span>
<span class="sd">        name : The name of inference output whose data will be described by this object.</span>
<span class="sd">        shape : The shape of the associated inference output.</span>
<span class="sd">        datatype : The data type of the associated inference output.</span>
<span class="sd">        data : The data of the inference output. When data is not set,</span>
<span class="sd">               raw_data is used for gRPC with numpy array bytes by calling set_data_from_numpy.</span>
<span class="sd">        parameters : The additional inference parameters.</span>
<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span> <span class="o">=</span> <span class="n">shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">=</span> <span class="n">datatype</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferOutput.as_numpy">
<code class="highlight language-python"><span class="n">as_numpy</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferOutput.as_numpy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decode the tensor output data as numpy array.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="numpy.ndarray">ndarray</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The numpy array of the associated inference output data.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">as_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Decode the tensor output data as numpy array.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The numpy array of the associated inference output data.</span>
<span class="sd">    """</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">to_np_dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"invalid datatype in the input"</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
            <span class="c1"># String results contain a 4-byte string length</span>
            <span class="c1"># followed by the actual string characters. Hence,</span>
            <span class="c1"># need to decode the raw bytes to convert into</span>
            <span class="c1"># array elements.</span>
            <span class="n">np_array</span> <span class="o">=</span> <span class="n">deserialize_bytes_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">np_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">np_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferOutput.set_data_from_numpy">
<code class="highlight language-python"><span class="n">set_data_from_numpy</span><span class="p">(</span><span class="n">output_tensor</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferOutput.set_data_from_numpy" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Set the tensor data from the specified numpy array for the inference output associated with this object.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>output_tensor</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The tensor data in numpy array format.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>binary_data</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>Indicates whether to set data for the input in binary format
          or explicit tensor within JSON. The default value is True,
          which means the data will be delivered as binary data with gRPC or in the
          HTTP body after the JSON object for REST.</p>
</div>
</td>
<td>
<code>True</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set_data_from_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_tensor</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">binary_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Set the tensor data from the specified numpy array for the inference output associated with this object.</span>

<span class="sd">    Args:</span>
<span class="sd">        output_tensor : The tensor data in numpy array format.</span>
<span class="sd">        binary_data : Indicates whether to set data for the input in binary format</span>
<span class="sd">                      or explicit tensor within JSON. The default value is True,</span>
<span class="sd">                      which means the data will be delivered as binary data with gRPC or in the</span>
<span class="sd">                      HTTP body after the JSON object for REST.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InferenceError if failed to set data for the output tensor.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output_tensor</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,)):</span>
        <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span><span class="s2">"input_tensor must be a numpy array"</span><span class="p">)</span>

    <span class="n">dtype</span> <span class="o">=</span> <span class="n">from_np_dtype</span><span class="p">(</span><span class="n">output_tensor</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">!=</span> <span class="n">dtype</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
            <span class="s2">"got unexpected datatype </span><span class="si">{}</span><span class="s2"> from numpy array, expected </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
        <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">valid_shape</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid_shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
            <span class="s2">"got unexpected numpy array shape [</span><span class="si">{}</span><span class="s2">], expected [</span><span class="si">{}</span><span class="s2">]"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">output_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shape</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">binary_data</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"binary_data_size"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span>
                        <span class="n">output_tensor</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s2">"refs_ok"</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">"C"</span>
                    <span class="p">):</span>
                        <span class="c1"># We need to convert the object to string using utf-8,</span>
                        <span class="c1"># if we want to use the binary_data=False. JSON requires</span>
                        <span class="c1"># the input to be a UTF-8 string.</span>
                        <span class="k">if</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">'Failed to encode "</span><span class="si">{</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">}</span><span class="s1">" using UTF-8. Please use binary_data=True, if'</span>
                    <span class="s2">" you want to pass a byte array."</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
            <span class="n">serialized_output</span> <span class="o">=</span> <span class="n">serialize_byte_tensor</span><span class="p">(</span><span class="n">output_tensor</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">serialized_output</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">serialized_output</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">output_tensor</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"binary_data_size"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">[</span><span class="s2">"binary_data_size"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest">
<code>InferRequest</code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InferRequest</span><span class="p">:</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>
    <span class="n">inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InferInput</span><span class="p">]</span>
    <span class="n">from_grpc</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">infer_inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InferInput</span><span class="p">],</span>
        <span class="n">request_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">raw_inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">from_grpc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">request_outputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">RequestedOutput</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""InferRequest Data Model.</span>

<span class="sd">        Args:</span>
<span class="sd">            model_name: The model name.</span>
<span class="sd">            infer_inputs: The inference inputs for the model.</span>
<span class="sd">            request_id: The id for the inference request.</span>
<span class="sd">            raw_inputs: The binary data for the inference inputs.</span>
<span class="sd">            from_grpc: Indicate if the data model is constructed from gRPC request.</span>
<span class="sd">            parameters: The additional inference parameters.</span>
<span class="sd">            request_outputs: The output tensors requested for this inference.</span>
<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">request_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">infer_inputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span> <span class="o">=</span> <span class="n">from_grpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_raw_outputs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">raw_inputs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_use_raw_outputs</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">raw_input</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw_inputs</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">raw_input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span> <span class="o">=</span> <span class="n">request_outputs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">use_binary_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""This attribute is used to determine if all the outputs should be returned as raw binary format.</span>
<span class="sd">        For REST,</span>
<span class="sd">            Get the binary_data_output attribute from the parameters. This will be ovverided by the individual output's 'binary_data' parameter.</span>
<span class="sd">        For GRPC,</span>
<span class="sd">            It is True, if the received inputs are raw_inputs, otherwise False. For GRPC, if the inputs are raw_inputs,</span>
<span class="sd">            then the outputs should be returned as raw_outputs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            a boolean indicating whether to use binary raw outputs</span>
<span class="sd">        """</span>
        <span class="c1"># If the request is from gRPC and we receive the inputs as raw inputs, then the outputs should be returned as raw binary format.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_raw_outputs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># If the request is from REST and the 'use_binary_outputs' parameter is set to True, then the outputs should be returned as raw binary format.</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span><span class="p">:</span>
            <span class="c1"># If it is a grpc request, then this configuration has no effect on the output.</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"binary_data_output"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_grpc</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">ModelInferRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferRequest"</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Class method to construct an InferRequest object from a ModelInferRequest object.</span>

<span class="sd">        Args:</span>
<span class="sd">            request (ModelInferRequest): The gRPC ModelInferRequest object to be converted.</span>

<span class="sd">        Returns:</span>
<span class="sd">            InferRequest: The resulting InferRequest object.</span>
<span class="sd">        """</span>
        <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">InferInput</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                <span class="n">datatype</span><span class="o">=</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">get_content</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">contents</span><span class="p">),</span>
                <span class="n">parameters</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">to_http_parameters</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">parameters</span>
                    <span class="k">else</span> <span class="kc">None</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">input_tensor</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">inputs</span>
        <span class="p">]</span>
        <span class="n">request_outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">RequestedOutput</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">parameters</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">to_http_parameters</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">outputs</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">request_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">infer_inputs</span><span class="o">=</span><span class="n">infer_inputs</span><span class="p">,</span>
            <span class="n">raw_inputs</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">raw_input_contents</span><span class="p">,</span>
            <span class="n">from_grpc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">request_outputs</span><span class="o">=</span><span class="n">request_outputs</span> <span class="k">if</span> <span class="n">request_outputs</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_bytes</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">req_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">json_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferRequest"</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""The class method to construct the InferRequest object from REST raw request bytes.</span>

<span class="sd">        Args:</span>
<span class="sd">            req_bytes (bytes): The raw InferRequest in bytes.</span>
<span class="sd">            json_length (int): The length of the json bytes.</span>
<span class="sd">            model_name (str): The name of the model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            InferRequest: The resulting InferRequest object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidInput: If the request format is unrecognized or if necessary fields are missing.</span>
<span class="sd">        """</span>
        <span class="n">json_bytes</span> <span class="o">=</span> <span class="n">req_bytes</span><span class="p">[:</span><span class="n">json_length</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">infer_req_dict</span> <span class="o">=</span> <span class="n">orjson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_bytes</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">orjson</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Unrecognized request format: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Read the raw binary inputs appended after json</span>
        <span class="n">start_index</span> <span class="o">=</span> <span class="n">json_length</span>
        <span class="k">for</span> <span class="n">input_</span> <span class="ow">in</span> <span class="n">infer_req_dict</span><span class="p">[</span><span class="s2">"inputs"</span><span class="p">]:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">input_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">infer_input</span> <span class="o">=</span> <span class="n">InferInput</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">input_</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span>
                <span class="n">shape</span><span class="o">=</span><span class="n">input_</span><span class="p">[</span><span class="s2">"shape"</span><span class="p">],</span>
                <span class="n">datatype</span><span class="o">=</span><span class="n">input_</span><span class="p">[</span><span class="s2">"datatype"</span><span class="p">],</span>
                <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">infer_input_data</span> <span class="o">=</span> <span class="n">input_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">infer_input_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"FP16"</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"Receiving FP16 data via JSON is not supported. Please use the binary data format "</span>
                        <span class="sa">f</span><span class="s2">"for input </span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
                    <span class="p">)</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">infer_input_data</span>
            <span class="k">elif</span> <span class="n">parameters</span> <span class="ow">and</span> <span class="s2">"binary_data_size"</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                <span class="n">binary_data_size</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"binary_data_size"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">binary_data_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"'binary_data_size' is not specified for input '</span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
                    <span class="p">)</span>
                <span class="n">end_index</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="n">binary_data_size</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">req_bytes</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span>
                    <span class="n">infer_input</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">(),</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
                <span class="n">start_index</span> <span class="o">=</span> <span class="n">end_index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"'data' field is missing for input '</span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
                <span class="p">)</span>
            <span class="n">infer_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input</span><span class="p">)</span>
        <span class="n">requested_outputs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">infer_req_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"outputs"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">requested_outputs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">RequestedOutput</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span>
                    <span class="n">parameters</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">infer_req_dict</span><span class="p">[</span><span class="s2">"outputs"</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">request_id</span><span class="o">=</span><span class="n">infer_req_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">infer_req_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">infer_inputs</span><span class="o">=</span><span class="n">infer_inputs</span><span class="p">,</span>
            <span class="n">request_outputs</span><span class="o">=</span><span class="n">requested_outputs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_inference_request</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">InferenceRequest</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferRequest"</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""The class method to construct the InferRequest object from InferenceRequest object.</span>

<span class="sd">        Args:</span>
<span class="sd">            request (InferenceRequest): The InferenceRequest object.</span>
<span class="sd">            model_name (str): The name of the model.</span>
<span class="sd">        Returns:</span>
<span class="sd">            InferRequest: The resulting InferRequest object.</span>
<span class="sd">        Raises:</span>
<span class="sd">            InvalidInput: If the request format is unrecognized.</span>
<span class="sd">        """</span>
        <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">infer_input</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"FP16"</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Sending FP16 data via JSON is not supported. "</span>
                    <span class="sa">f</span><span class="s2">"Please use the binary data format for input </span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>
            <span class="n">infer_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">InferInput</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">shape</span><span class="o">=</span><span class="n">infer_input</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                    <span class="n">datatype</span><span class="o">=</span><span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                    <span class="n">parameters</span><span class="o">=</span><span class="p">(</span>
                        <span class="p">{}</span> <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="n">requested_outputs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="n">requested_outputs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">RequestedOutput</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">parameters</span><span class="o">=</span><span class="p">({}</span> <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">output</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">outputs</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">request_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">infer_inputs</span><span class="o">=</span><span class="n">infer_inputs</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">request_outputs</span><span class="o">=</span><span class="n">requested_outputs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Converts the InferRequest object to v2 REST InferRequest Dict or bytes.</span>
<span class="sd">        This method is used to convert the InferRequest object into a format that can be sent over a REST API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[Union[bytes, Dict], Optional[int]]: A tuple containing the InferRequest in bytes or Dict and the length of the JSON part of the request.</span>
<span class="sd">                                                      If it is dict, then the json length will be None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidInput: If the data is missing for an input or if both 'data' and 'raw_data' fields are set for an input.</span>
<span class="sd">        """</span>
        <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">raw_inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">infer_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"'data' field is missing for output '</span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Both 'data' and 'raw_data' fields are set for input '</span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"FP16"</span> <span class="ow">and</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Sending FP16 data via JSON is not supported. Please use the binary data format for input </span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>

            <span class="n">infer_input_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"name"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">"shape"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="s2">"datatype"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span>
                    <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">:</span>
                <span class="n">raw_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]</span> <span class="o">=</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span>
            <span class="n">infer_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input_dict</span><span class="p">)</span>
        <span class="n">requested_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">requested_output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span><span class="p">:</span>
                <span class="n">requested_output_dict</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">"name"</span><span class="p">:</span> <span class="n">requested_output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="n">requested_output</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                    <span class="n">requested_output_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span>
                        <span class="n">requested_output</span><span class="o">.</span><span class="n">parameters</span>
                    <span class="p">)</span>
                <span class="n">requested_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">requested_output_dict</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
            <span class="s2">"model_name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="s2">"inputs"</span><span class="p">:</span> <span class="n">infer_inputs</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">requested_outputs</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s2">"outputs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">requested_outputs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_inputs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">infer_response_bytes</span> <span class="o">=</span> <span class="n">orjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="n">json_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">infer_response_bytes</span><span class="p">)</span>
            <span class="n">infer_response_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">infer_response_bytes</span><span class="p">]</span> <span class="o">+</span> <span class="n">raw_inputs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">infer_response_bytes</span><span class="p">,</span> <span class="n">json_length</span>

        <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">to_grpc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelInferRequest</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Converts the InferRequest object to gRPC ModelInferRequest type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ModelInferRequest gRPC type converted from InferRequest object.</span>
<span class="sd">        """</span>
        <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">raw_input_contents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">infer_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">infer_input_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"name"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">"shape"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="s2">"datatype"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_grpc_parameters</span><span class="p">(</span>
                    <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">raw_input_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"input data is not a List"</span><span class="p">)</span>
                <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"contents"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">data_key</span> <span class="o">=</span> <span class="n">GRPC_CONTENT_DATATYPE_MAPPINGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">data_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">infer_input</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="nb">bytes</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span>
                    <span class="p">]</span>  <span class="c1"># str to byte conversion for grpc proto</span>
                    <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"contents"</span><span class="p">][</span><span class="n">data_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"invalid input datatype"</span><span class="p">)</span>
            <span class="n">infer_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input_dict</span><span class="p">)</span>
        <span class="n">request_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">request_output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span><span class="p">:</span>
                <span class="n">request_output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="n">request_output</span><span class="o">.</span><span class="n">name</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">request_output</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                    <span class="n">request_output_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_grpc_parameters</span><span class="p">(</span>
                        <span class="n">request_output</span><span class="o">.</span><span class="n">parameters</span>
                    <span class="p">)</span>
                <span class="n">request_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_output_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ModelInferRequest</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">inputs</span><span class="o">=</span><span class="n">infer_inputs</span><span class="p">,</span>
            <span class="n">raw_input_contents</span><span class="o">=</span><span class="n">raw_input_contents</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">to_grpc_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">outputs</span><span class="o">=</span><span class="n">request_outputs</span> <span class="k">if</span> <span class="n">request_outputs</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Decode the tensor inputs as pandas dataframe.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The inference input data as pandas dataframe</span>
<span class="sd">        """</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="n">input_data</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">data</span>
            <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
                <span class="n">input_data</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">data</span>
                <span class="p">]</span>
            <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="nb">input</span><span class="o">.</span><span class="n">name</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_input_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">InferInput</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Find an input Tensor in the InferenceRequest that has the given name</span>
<span class="sd">        Args:</span>
<span class="sd">            name : str</span>
<span class="sd">                name of the input Tensor object</span>
<span class="sd">        Returns:</span>
<span class="sd">            InferInput</span>
<span class="sd">                The InferInput with the specified name, or None if no</span>
<span class="sd">                input with this name exists</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">infer_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">infer_input</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">InferRequest</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">model_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">from_grpc</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">request_outputs</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">"model_name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="s2">"inputs"</span><span class="p">:</span> <span class="p">[</span><span class="n">infer_input</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">infer_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">],</span>
            <span class="s2">"parameters"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="s2">"from_grpc"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">'"id": "</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">",'</span>
            <span class="sa">f</span><span class="s1">'"model_name": "</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s1">",'</span>
            <span class="sa">f</span><span class="s1">'"inputs": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s1">,'</span>
            <span class="sa">f</span><span class="s1">'"parameters": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="si">}</span><span class="s1">,'</span>
            <span class="sa">f</span><span class="s1">'"from_grpc": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span><span class="si">}</span><span class="s1">'</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest.use_binary_outputs">
<code class="highlight language-python"><span class="n">use_binary_outputs</span><span class="p">:</span> <span class="nb">bool</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest.use_binary_outputs" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>This attribute is used to determine if all the outputs should be returned as raw binary format.
For REST,
    Get the binary_data_output attribute from the parameters. This will be ovverided by the individual output's 'binary_data' parameter.
For GRPC,
    It is True, if the received inputs are raw_inputs, otherwise False. For GRPC, if the inputs are raw_inputs,
    then the outputs should be returned as raw_outputs.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>bool</code>
</td>
<td>
<div class="doc-md-description">
<p>a boolean indicating whether to use binary raw outputs</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">infer_inputs</span><span class="p">,</span> <span class="n">request_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw_inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_grpc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request_outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest.__init__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>InferRequest Data Model.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>model_name</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The model name.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>infer_inputs</code></td>
<td>
<code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferInput" href="#kserve.protocol.infer_type.InferInput">InferInput</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>The inference inputs for the model.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>request_id</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[str]</code>
</td>
<td>
<div class="doc-md-description">
<p>The id for the inference request.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>raw_inputs</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The binary data for the inference inputs.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>from_grpc</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[bool]</code>
</td>
<td>
<div class="doc-md-description">
<p>Indicate if the data model is constructed from gRPC request.</p>
</div>
</td>
<td>
<code>False</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>parameters</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="google.protobuf.internal.containers.MessageMap">MessageMap</span>[str, <span title="kserve.protocol.grpc.grpc_predict_v2_pb2.InferParameter">InferParameter</span>]]]</code>
</td>
<td>
<div class="doc-md-description">
<p>The additional inference parameters.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>request_outputs</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.RequestedOutput" href="#kserve.protocol.infer_type.RequestedOutput">RequestedOutput</a>]]</code>
</td>
<td>
<div class="doc-md-description">
<p>The output tensors requested for this inference.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">infer_inputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InferInput</span><span class="p">],</span>
    <span class="n">request_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">raw_inputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">from_grpc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">request_outputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">RequestedOutput</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""InferRequest Data Model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_name: The model name.</span>
<span class="sd">        infer_inputs: The inference inputs for the model.</span>
<span class="sd">        request_id: The id for the inference request.</span>
<span class="sd">        raw_inputs: The binary data for the inference inputs.</span>
<span class="sd">        from_grpc: Indicate if the data model is constructed from gRPC request.</span>
<span class="sd">        parameters: The additional inference parameters.</span>
<span class="sd">        request_outputs: The output tensors requested for this inference.</span>
<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">request_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">infer_inputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span> <span class="o">=</span> <span class="n">from_grpc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_raw_outputs</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">raw_inputs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_raw_outputs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">raw_input</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw_inputs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">raw_input</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span> <span class="o">=</span> <span class="n">request_outputs</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest.as_dataframe">
<code class="highlight language-python"><span class="n">as_dataframe</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest.as_dataframe" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Decode the tensor inputs as pandas dataframe.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="pandas.DataFrame">DataFrame</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The inference input data as pandas dataframe</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">as_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Decode the tensor inputs as pandas dataframe.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The inference input data as pandas dataframe</span>
<span class="sd">    """</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
        <span class="n">input_data</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="nb">input</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"BYTES"</span><span class="p">:</span>
            <span class="n">input_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">input</span><span class="o">.</span><span class="n">data</span>
            <span class="p">]</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="nb">input</span><span class="o">.</span><span class="n">name</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest.from_bytes">
<code class="highlight language-python"><span class="n">from_bytes</span><span class="p">(</span><span class="n">req_bytes</span><span class="p">,</span> <span class="n">json_length</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest.from_bytes" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The class method to construct the InferRequest object from REST raw request bytes.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>req_bytes</code></td>
<td>
<code>bytes</code>
</td>
<td>
<div class="doc-md-description">
<p>The raw InferRequest in bytes.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>json_length</code></td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>The length of the json bytes.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>model_name</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of the model.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>InferRequest</code></td> <td>
<code><a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferRequest" href="#kserve.protocol.infer_type.InferRequest">InferRequest</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The resulting InferRequest object.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="kserve.errors.InvalidInput">InvalidInput</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the request format is unrecognized or if necessary fields are missing.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_bytes</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">req_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">json_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferRequest"</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The class method to construct the InferRequest object from REST raw request bytes.</span>

<span class="sd">    Args:</span>
<span class="sd">        req_bytes (bytes): The raw InferRequest in bytes.</span>
<span class="sd">        json_length (int): The length of the json bytes.</span>
<span class="sd">        model_name (str): The name of the model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        InferRequest: The resulting InferRequest object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InvalidInput: If the request format is unrecognized or if necessary fields are missing.</span>
<span class="sd">    """</span>
    <span class="n">json_bytes</span> <span class="o">=</span> <span class="n">req_bytes</span><span class="p">[:</span><span class="n">json_length</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">infer_req_dict</span> <span class="o">=</span> <span class="n">orjson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_bytes</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">orjson</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Unrecognized request format: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Read the raw binary inputs appended after json</span>
    <span class="n">start_index</span> <span class="o">=</span> <span class="n">json_length</span>
    <span class="k">for</span> <span class="n">input_</span> <span class="ow">in</span> <span class="n">infer_req_dict</span><span class="p">[</span><span class="s2">"inputs"</span><span class="p">]:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">input_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">infer_input</span> <span class="o">=</span> <span class="n">InferInput</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">input_</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">input_</span><span class="p">[</span><span class="s2">"shape"</span><span class="p">],</span>
            <span class="n">datatype</span><span class="o">=</span><span class="n">input_</span><span class="p">[</span><span class="s2">"datatype"</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">infer_input_data</span> <span class="o">=</span> <span class="n">input_</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">infer_input_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"FP16"</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Receiving FP16 data via JSON is not supported. Please use the binary data format "</span>
                    <span class="sa">f</span><span class="s2">"for input </span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>
            <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">infer_input_data</span>
        <span class="k">elif</span> <span class="n">parameters</span> <span class="ow">and</span> <span class="s2">"binary_data_size"</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">binary_data_size</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"binary_data_size"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">binary_data_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"'binary_data_size' is not specified for input '</span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
                <span class="p">)</span>
            <span class="n">end_index</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="n">binary_data_size</span>
            <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">req_bytes</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]</span>
            <span class="n">infer_input</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">(),</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="n">end_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"'data' field is missing for input '</span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
            <span class="p">)</span>
        <span class="n">infer_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input</span><span class="p">)</span>
    <span class="n">requested_outputs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">infer_req_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"outputs"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">requested_outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">RequestedOutput</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span>
                <span class="n">parameters</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">infer_req_dict</span><span class="p">[</span><span class="s2">"outputs"</span><span class="p">]</span>
        <span class="p">]</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">request_id</span><span class="o">=</span><span class="n">infer_req_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">infer_req_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">infer_inputs</span><span class="o">=</span><span class="n">infer_inputs</span><span class="p">,</span>
        <span class="n">request_outputs</span><span class="o">=</span><span class="n">requested_outputs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest.from_grpc">
<code class="highlight language-python"><span class="n">from_grpc</span><span class="p">(</span><span class="n">request</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest.from_grpc" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Class method to construct an InferRequest object from a ModelInferRequest object.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>request</code></td>
<td>
<code><span title="kserve.protocol.grpc.grpc_predict_v2_pb2.ModelInferRequest">ModelInferRequest</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The gRPC ModelInferRequest object to be converted.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>InferRequest</code></td> <td>
<code><a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferRequest" href="#kserve.protocol.infer_type.InferRequest">InferRequest</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The resulting InferRequest object.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_grpc</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">ModelInferRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferRequest"</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Class method to construct an InferRequest object from a ModelInferRequest object.</span>

<span class="sd">    Args:</span>
<span class="sd">        request (ModelInferRequest): The gRPC ModelInferRequest object to be converted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        InferRequest: The resulting InferRequest object.</span>
<span class="sd">    """</span>
    <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">InferInput</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">shape</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
            <span class="n">datatype</span><span class="o">=</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">get_content</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">contents</span><span class="p">),</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">(</span>
                <span class="n">to_http_parameters</span><span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">parameters</span>
                <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">input_tensor</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">inputs</span>
    <span class="p">]</span>
    <span class="n">request_outputs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">RequestedOutput</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="p">(</span>
                <span class="n">to_http_parameters</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">outputs</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">request_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">infer_inputs</span><span class="o">=</span><span class="n">infer_inputs</span><span class="p">,</span>
        <span class="n">raw_inputs</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">raw_input_contents</span><span class="p">,</span>
        <span class="n">from_grpc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
        <span class="n">request_outputs</span><span class="o">=</span><span class="n">request_outputs</span> <span class="k">if</span> <span class="n">request_outputs</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest.from_inference_request">
<code class="highlight language-python"><span class="n">from_inference_request</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest.from_inference_request" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The class method to construct the InferRequest object from InferenceRequest object.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>request</code></td>
<td>
<code><span title="kserve.protocol.rest.v2_datamodels.InferenceRequest">InferenceRequest</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The InferenceRequest object.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>model_name</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of the model.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_inference_request</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">InferenceRequest</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferRequest"</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The class method to construct the InferRequest object from InferenceRequest object.</span>

<span class="sd">    Args:</span>
<span class="sd">        request (InferenceRequest): The InferenceRequest object.</span>
<span class="sd">        model_name (str): The name of the model.</span>
<span class="sd">    Returns:</span>
<span class="sd">        InferRequest: The resulting InferRequest object.</span>
<span class="sd">    Raises:</span>
<span class="sd">        InvalidInput: If the request format is unrecognized.</span>
<span class="sd">    """</span>
    <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">infer_input</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"FP16"</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Sending FP16 data via JSON is not supported. "</span>
                <span class="sa">f</span><span class="s2">"Please use the binary data format for input </span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>
        <span class="n">infer_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">InferInput</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="n">infer_input</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="n">datatype</span><span class="o">=</span><span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                <span class="n">parameters</span><span class="o">=</span><span class="p">(</span>
                    <span class="p">{}</span> <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span>
                <span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="n">requested_outputs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
        <span class="n">requested_outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">RequestedOutput</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">parameters</span><span class="o">=</span><span class="p">({}</span> <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">output</span><span class="o">.</span><span class="n">parameters</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">outputs</span>
        <span class="p">]</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">request_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">infer_inputs</span><span class="o">=</span><span class="n">infer_inputs</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
        <span class="n">request_outputs</span><span class="o">=</span><span class="n">requested_outputs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest.get_input_by_name">
<code class="highlight language-python"><span class="n">get_input_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest.get_input_by_name" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Find an input Tensor in the InferenceRequest that has the given name
Args:
    name : str
        name of the input Tensor object
Returns:
    InferInput
        The InferInput with the specified name, or None if no
        input with this name exists</p>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_input_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">InferInput</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Find an input Tensor in the InferenceRequest that has the given name</span>
<span class="sd">    Args:</span>
<span class="sd">        name : str</span>
<span class="sd">            name of the input Tensor object</span>
<span class="sd">    Returns:</span>
<span class="sd">        InferInput</span>
<span class="sd">            The InferInput with the specified name, or None if no</span>
<span class="sd">            input with this name exists</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">infer_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">infer_input</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest.to_grpc">
<code class="highlight language-python"><span class="n">to_grpc</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest.to_grpc" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Converts the InferRequest object to gRPC ModelInferRequest type.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="kserve.protocol.grpc.grpc_predict_v2_pb2.ModelInferRequest">ModelInferRequest</span></code>
</td>
<td>
<div class="doc-md-description">
<p>ModelInferRequest gRPC type converted from InferRequest object.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_grpc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelInferRequest</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Converts the InferRequest object to gRPC ModelInferRequest type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ModelInferRequest gRPC type converted from InferRequest object.</span>
<span class="sd">    """</span>
    <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">raw_input_contents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">infer_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">infer_input</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">infer_input_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">"shape"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="s2">"datatype"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_grpc_parameters</span><span class="p">(</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">raw_input_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"input data is not a List"</span><span class="p">)</span>
            <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"contents"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">data_key</span> <span class="o">=</span> <span class="n">GRPC_CONTENT_DATATYPE_MAPPINGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">data_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">bytes</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span>
                <span class="p">]</span>  <span class="c1"># str to byte conversion for grpc proto</span>
                <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"contents"</span><span class="p">][</span><span class="n">data_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"invalid input datatype"</span><span class="p">)</span>
        <span class="n">infer_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input_dict</span><span class="p">)</span>
    <span class="n">request_outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">request_output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span><span class="p">:</span>
            <span class="n">request_output_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="n">request_output</span><span class="o">.</span><span class="n">name</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">request_output</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">request_output_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_grpc_parameters</span><span class="p">(</span>
                    <span class="n">request_output</span><span class="o">.</span><span class="n">parameters</span>
                <span class="p">)</span>
            <span class="n">request_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_output_dict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ModelInferRequest</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">infer_inputs</span><span class="p">,</span>
        <span class="n">raw_input_contents</span><span class="o">=</span><span class="n">raw_input_contents</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">to_grpc_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">outputs</span><span class="o">=</span><span class="n">request_outputs</span> <span class="k">if</span> <span class="n">request_outputs</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferRequest.to_rest">
<code class="highlight language-python"><span class="n">to_rest</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferRequest.to_rest" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Converts the InferRequest object to v2 REST InferRequest Dict or bytes.
This method is used to convert the InferRequest object into a format that can be sent over a REST API.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Tuple">Tuple</span>[<span title="typing.Union">Union</span>[bytes, <span title="typing.Dict">Dict</span>], <span title="typing.Optional">Optional</span>[int]]</code>
</td>
<td>
<div class="doc-md-description">
<p>Tuple[Union[bytes, Dict], Optional[int]]: A tuple containing the InferRequest in bytes or Dict and the length of the JSON part of the request.
                                      If it is dict, then the json length will be None.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="kserve.errors.InvalidInput">InvalidInput</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the data is missing for an input or if both 'data' and 'raw_data' fields are set for an input.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Converts the InferRequest object to v2 REST InferRequest Dict or bytes.</span>
<span class="sd">    This method is used to convert the InferRequest object into a format that can be sent over a REST API.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[Union[bytes, Dict], Optional[int]]: A tuple containing the InferRequest in bytes or Dict and the length of the JSON part of the request.</span>
<span class="sd">                                                  If it is dict, then the json length will be None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InvalidInput: If the data is missing for an input or if both 'data' and 'raw_data' fields are set for an input.</span>
<span class="sd">    """</span>
    <span class="n">infer_inputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">raw_inputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">infer_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"'data' field is missing for output '</span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">infer_input</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Both 'data' and 'raw_data' fields are set for input '</span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"FP16"</span> <span class="ow">and</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Sending FP16 data via JSON is not supported. Please use the binary data format for input </span><span class="si">{</span><span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="n">infer_input_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">"shape"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="s2">"datatype"</span><span class="p">:</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span>
                <span class="n">infer_input</span><span class="o">.</span><span class="n">parameters</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">:</span>
            <span class="n">raw_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infer_input_dict</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]</span> <span class="o">=</span> <span class="n">infer_input</span><span class="o">.</span><span class="n">data</span>
        <span class="n">infer_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_input_dict</span><span class="p">)</span>
    <span class="n">requested_outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">requested_output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_outputs</span><span class="p">:</span>
            <span class="n">requested_output_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"name"</span><span class="p">:</span> <span class="n">requested_output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">requested_output</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">requested_output_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span>
                    <span class="n">requested_output</span><span class="o">.</span><span class="n">parameters</span>
                <span class="p">)</span>
            <span class="n">requested_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">requested_output_dict</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
        <span class="s2">"model_name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="s2">"inputs"</span><span class="p">:</span> <span class="n">infer_inputs</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">requested_outputs</span><span class="p">:</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"outputs"</span><span class="p">]</span> <span class="o">=</span> <span class="n">requested_outputs</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_inputs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">infer_response_bytes</span> <span class="o">=</span> <span class="n">orjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">json_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">infer_response_bytes</span><span class="p">)</span>
        <span class="n">infer_response_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">infer_response_bytes</span><span class="p">]</span> <span class="o">+</span> <span class="n">raw_inputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">infer_response_bytes</span><span class="p">,</span> <span class="n">json_length</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.protocol.infer_type.InferResponse">
<code>InferResponse</code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferResponse" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InferResponse</span><span class="p">:</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">model_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span>
    <span class="n">outputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InferOutput</span><span class="p">]</span>
    <span class="n">from_grpc</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">response_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">infer_outputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InferOutput</span><span class="p">],</span>
        <span class="n">model_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">raw_outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">from_grpc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">use_binary_outputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">requested_outputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">RequestedOutput</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""The InferResponse Data Model</span>

<span class="sd">        Args:</span>
<span class="sd">            response_id: The id of the inference response.</span>
<span class="sd">            model_name: The name of the model.</span>
<span class="sd">            infer_outputs: The inference outputs of the inference response.</span>
<span class="sd">            model_version: The version of the model.</span>
<span class="sd">            raw_outputs: The raw binary data of the inference outputs.</span>
<span class="sd">            from_grpc: Indicate if the InferResponse is constructed from a gRPC response.</span>
<span class="sd">            parameters: The additional inference parameters.</span>
<span class="sd">            use_binary_outputs: A boolean indicating whether the data for the outputs should be in binary format when sent over REST API.</span>
<span class="sd">                                This will be overridden by the individual output's binary_data attribute.</span>
<span class="sd">            requested_outputs: The output tensors requested for this inference.</span>
<span class="sd">        """</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">response_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_version</span> <span class="o">=</span> <span class="n">model_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">infer_outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span> <span class="o">=</span> <span class="n">from_grpc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span> <span class="o">=</span> <span class="n">requested_outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_use_binary_outputs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">use_binary_outputs</span>
        <span class="k">if</span> <span class="n">raw_outputs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">raw_output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw_outputs</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">raw_output</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_grpc</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">ModelInferResponse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferResponse"</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""The class method to construct the InferResponse object from gRPC message type.</span>

<span class="sd">        Args:</span>
<span class="sd">            response: The GRPC response as ModelInferResponse object.</span>
<span class="sd">        Returns:</span>
<span class="sd">            InferResponse object.</span>
<span class="sd">        """</span>
        <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">InferOutput</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">shape</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                <span class="n">datatype</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">get_content</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">contents</span><span class="p">),</span>
                <span class="n">parameters</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">outputs</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">model_version</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">model_version</span><span class="p">,</span>
            <span class="n">response_id</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="n">infer_outputs</span><span class="o">=</span><span class="n">infer_outputs</span><span class="p">,</span>
            <span class="n">raw_outputs</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">raw_output_contents</span><span class="p">,</span>
            <span class="n">from_grpc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_rest</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferResponse"</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""The class method to construct the InferResponse object from REST message type.</span>

<span class="sd">        Args:</span>
<span class="sd">            response: The response as a dict.</span>
<span class="sd">        Returns:</span>
<span class="sd">            InferResponse object.</span>
<span class="sd">        """</span>
        <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">InferOutput</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span>
                <span class="n">shape</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">"shape"</span><span class="p">]),</span>
                <span class="n">datatype</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"datatype"</span><span class="p">],</span>
                <span class="n">data</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"data"</span><span class="p">],</span>
                <span class="n">parameters</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">"outputs"</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"model_name"</span><span class="p">),</span>
            <span class="n">model_version</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"model_version"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">response_id</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">infer_outputs</span><span class="o">=</span><span class="n">infer_outputs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_bytes</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">res_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
        <span class="n">json_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferResponse"</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Class method to construct an InferResponse object from raw response bytes.</span>
<span class="sd">        This method is used to convert the raw response bytes received from a REST API into an InferResponse object.</span>

<span class="sd">        Args:</span>
<span class="sd">            res_bytes (bytes): The raw response bytes received from the REST API.</span>
<span class="sd">            json_length (int): The length of the JSON part of the response.</span>

<span class="sd">        Returns:</span>
<span class="sd">            InferResponse: The constructed InferResponse object.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidInput: If the response format is unrecognized or if necessary fields are missing in the response.</span>
<span class="sd">            InferenceError: if failed to set data for the output tensor.</span>
<span class="sd">        """</span>
        <span class="c1"># If json_length is equal to the length of the response bytes, then the response does not have</span>
        <span class="c1"># any appended binary data after the json.</span>
        <span class="n">json_bytes</span> <span class="o">=</span> <span class="n">res_bytes</span><span class="p">[:</span><span class="n">json_length</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">infer_res_dict</span> <span class="o">=</span> <span class="n">orjson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_bytes</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">orjson</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Unrecognized request format: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">infer_res_dict</span><span class="p">[</span><span class="s2">"model_name"</span><span class="p">]</span>
        <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Read the raw binary outputs appended after json</span>
        <span class="n">start_index</span> <span class="o">=</span> <span class="n">json_length</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">infer_res_dict</span><span class="p">[</span><span class="s2">"outputs"</span><span class="p">]:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">infer_output</span> <span class="o">=</span> <span class="n">InferOutput</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span>
                <span class="n">shape</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"shape"</span><span class="p">],</span>
                <span class="n">datatype</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"datatype"</span><span class="p">],</span>
                <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">parameters</span> <span class="ow">and</span> <span class="s2">"binary_data_size"</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
                <span class="n">binary_data_size</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"binary_data_size"</span><span class="p">)</span>
                <span class="n">end_index</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="n">binary_data_size</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">res_bytes</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span>
                    <span class="n">infer_output</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">(),</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>
                <span class="n">start_index</span> <span class="o">=</span> <span class="n">end_index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">infer_output_data</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">infer_output_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">"'data' field is missing for output '</span><span class="si">{</span><span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
                    <span class="p">)</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">infer_output_data</span>
            <span class="n">infer_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">response_id</span><span class="o">=</span><span class="n">infer_res_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">infer_res_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">infer_outputs</span><span class="o">=</span><span class="n">infer_outputs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">to_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Converts the InferResponse object to v2 REST InferResponse Dict or bytes.</span>
<span class="sd">        This method is used to convert the InferResponse object into a format that can be sent over a REST API.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[Union[bytes, Dict], Optional[int]]: A tuple containing the InferResponse in bytes or Dict and the length of the JSON part of the response.</span>
<span class="sd">                                                      If it is dict, then the json length will be None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            InvalidInput: If the output data is not a numpy array, bytes, or list.</span>
<span class="sd">        """</span>
        <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">raw_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">use_binary_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_binary_outputs</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span>

        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
            <span class="n">infer_output</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_output_by_name</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span>
                <span class="k">else</span> <span class="n">output</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span><span class="p">:</span>
                <span class="n">use_binary_data</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">binary_data</span>
            <span class="k">if</span> <span class="n">infer_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Unexpected inference output '</span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"'data' field is missing for output '</span><span class="si">{</span><span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span>
                    <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="n">use_binary_data</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span> <span class="ow">or</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">:</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span>
                    <span class="n">infer_output</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">(),</span> <span class="n">binary_data</span><span class="o">=</span><span class="n">use_binary_data</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"FP16"</span> <span class="ow">and</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"Sending FP16 data via JSON is not supported. Please use the binary data format for output </span><span class="si">{</span><span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
                <span class="p">)</span>

            <span class="n">infer_output_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"name"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">"shape"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="s2">"datatype"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span>
                    <span class="n">infer_output</span><span class="o">.</span><span class="n">parameters</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">use_binary_data</span><span class="p">:</span>
                <span class="n">raw_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]</span> <span class="o">=</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span>
            <span class="n">infer_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output_dict</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">"model_name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="s2">"model_version"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_version</span><span class="p">,</span>
            <span class="s2">"outputs"</span><span class="p">:</span> <span class="n">infer_outputs</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_outputs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">infer_response_bytes</span> <span class="o">=</span> <span class="n">orjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="n">json_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">infer_response_bytes</span><span class="p">)</span>
            <span class="n">infer_response_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">infer_response_bytes</span><span class="p">]</span> <span class="o">+</span> <span class="n">raw_outputs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">infer_response_bytes</span><span class="p">,</span> <span class="n">json_length</span>

        <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">to_grpc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelInferResponse</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Converts the InferResponse object to gRPC ModelInferResponse type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The ModelInferResponse gRPC message.</span>
<span class="sd">        Raises:</span>
<span class="sd">            InvalidInput: If the output data is not a List or if the datatype is invalid.</span>
<span class="sd">        """</span>
        <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">raw_output_contents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">use_raw_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_binary_outputs</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_binary_outputs</span><span class="p">:</span>
            <span class="c1"># If FP16 datatype is present in the outputs use raw outputs.</span>
            <span class="k">if</span> <span class="n">_contains_fp16_datatype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">use_raw_outputs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">infer_output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">use_raw_outputs</span>
                <span class="ow">and</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span>
                <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">infer_output_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">"name"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">"shape"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                <span class="s2">"datatype"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_grpc_parameters</span><span class="p">(</span>
                    <span class="n">infer_output</span><span class="o">.</span><span class="n">parameters</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">raw_output_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"output data is not a List"</span><span class="p">)</span>
                <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"contents"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">data_key</span> <span class="o">=</span> <span class="n">GRPC_CONTENT_DATATYPE_MAPPINGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">infer_output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">data_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">infer_output</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="nb">bytes</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span>
                        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span>
                    <span class="p">]</span>  <span class="c1"># str to byte conversion for grpc proto</span>
                    <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"contents"</span><span class="p">][</span><span class="n">data_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"to_grpc: invalid output datatype"</span><span class="p">)</span>
            <span class="n">infer_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ModelInferResponse</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">model_version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_version</span><span class="p">,</span>
            <span class="n">outputs</span><span class="o">=</span><span class="n">infer_outputs</span><span class="p">,</span>
            <span class="n">raw_output_contents</span><span class="o">=</span><span class="n">raw_output_contents</span><span class="p">,</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">to_grpc_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_output_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">InferOutput</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Find an output Tensor in the InferResponse that has the given name</span>

<span class="sd">        Args:</span>
<span class="sd">            name : str</span>
<span class="sd">                name of the output Tensor object</span>
<span class="sd">        Returns:</span>
<span class="sd">            InferOutput</span>
<span class="sd">                The InferOutput with the specified name, or None if no</span>
<span class="sd">                output with this name exists</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">infer_output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">infer_output</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">InferResponse</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">model_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_version</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">model_version</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">from_grpc</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">"model_name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="s2">"outputs"</span><span class="p">:</span> <span class="p">[</span><span class="n">infer_output</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">infer_output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">],</span>
            <span class="s2">"parameters"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
            <span class="s2">"from_grpc"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s1">'"id": "</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">",'</span>
            <span class="sa">f</span><span class="s1">'"model_name": "</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s1">",'</span>
            <span class="sa">f</span><span class="s1">'"outputs": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s1">,'</span>
            <span class="sa">f</span><span class="s1">'"parameters": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="si">}</span><span class="s1">,'</span>
            <span class="sa">f</span><span class="s1">'"from_grpc": </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span><span class="si">}</span><span class="s1">'</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferResponse.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">response_id</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">infer_outputs</span><span class="p">,</span> <span class="n">model_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">raw_outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_grpc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_binary_outputs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">requested_outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferResponse.__init__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The InferResponse Data Model</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>response_id</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The id of the inference response.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>model_name</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of the model.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>infer_outputs</code></td>
<td>
<code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferOutput" href="#kserve.protocol.infer_type.InferOutput">InferOutput</a>]</code>
</td>
<td>
<div class="doc-md-description">
<p>The inference outputs of the inference response.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>model_version</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[str]</code>
</td>
<td>
<div class="doc-md-description">
<p>The version of the model.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>raw_outputs</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>The raw binary data of the inference outputs.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>from_grpc</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[bool]</code>
</td>
<td>
<div class="doc-md-description">
<p>Indicate if the InferResponse is constructed from a gRPC response.</p>
</div>
</td>
<td>
<code>False</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>parameters</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="google.protobuf.internal.containers.MessageMap">MessageMap</span>[str, <span title="kserve.protocol.grpc.grpc_predict_v2_pb2.InferParameter">InferParameter</span>]]]</code>
</td>
<td>
<div class="doc-md-description">
<p>The additional inference parameters.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>use_binary_outputs</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[bool]</code>
</td>
<td>
<div class="doc-md-description">
<p>A boolean indicating whether the data for the outputs should be in binary format when sent over REST API.
                This will be overridden by the individual output's binary_data attribute.</p>
</div>
</td>
<td>
<code>False</code>
</td>
</tr>
<tr class="doc-section-item">
<td><code>requested_outputs</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.RequestedOutput" href="#kserve.protocol.infer_type.RequestedOutput">RequestedOutput</a>]]</code>
</td>
<td>
<div class="doc-md-description">
<p>The output tensors requested for this inference.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">response_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">infer_outputs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InferOutput</span><span class="p">],</span>
    <span class="n">model_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">raw_outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">from_grpc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">use_binary_outputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">requested_outputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">RequestedOutput</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""The InferResponse Data Model</span>

<span class="sd">    Args:</span>
<span class="sd">        response_id: The id of the inference response.</span>
<span class="sd">        model_name: The name of the model.</span>
<span class="sd">        infer_outputs: The inference outputs of the inference response.</span>
<span class="sd">        model_version: The version of the model.</span>
<span class="sd">        raw_outputs: The raw binary data of the inference outputs.</span>
<span class="sd">        from_grpc: Indicate if the InferResponse is constructed from a gRPC response.</span>
<span class="sd">        parameters: The additional inference parameters.</span>
<span class="sd">        use_binary_outputs: A boolean indicating whether the data for the outputs should be in binary format when sent over REST API.</span>
<span class="sd">                            This will be overridden by the individual output's binary_data attribute.</span>
<span class="sd">        requested_outputs: The output tensors requested for this inference.</span>
<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">response_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="n">model_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_version</span> <span class="o">=</span> <span class="n">model_version</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">infer_outputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">from_grpc</span> <span class="o">=</span> <span class="n">from_grpc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span> <span class="o">=</span> <span class="n">requested_outputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_use_binary_outputs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">use_binary_outputs</span>
    <span class="k">if</span> <span class="n">raw_outputs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">raw_output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">raw_outputs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">raw_output</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferResponse.from_bytes">
<code class="highlight language-python"><span class="n">from_bytes</span><span class="p">(</span><span class="n">res_bytes</span><span class="p">,</span> <span class="n">json_length</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferResponse.from_bytes" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Class method to construct an InferResponse object from raw response bytes.
This method is used to convert the raw response bytes received from a REST API into an InferResponse object.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>res_bytes</code></td>
<td>
<code>bytes</code>
</td>
<td>
<div class="doc-md-description">
<p>The raw response bytes received from the REST API.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>json_length</code></td>
<td>
<code>int</code>
</td>
<td>
<div class="doc-md-description">
<p>The length of the JSON part of the response.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>InferResponse</code></td> <td>
<code><a class="autorefs autorefs-internal" title="kserve.protocol.infer_type.InferResponse" href="#kserve.protocol.infer_type.InferResponse">InferResponse</a></code>
</td>
<td>
<div class="doc-md-description">
<p>The constructed InferResponse object.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="kserve.errors.InvalidInput">InvalidInput</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the response format is unrecognized or if necessary fields are missing in the response.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="kserve.errors.InferenceError">InferenceError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>if failed to set data for the output tensor.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_bytes</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">res_bytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
    <span class="n">json_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferResponse"</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Class method to construct an InferResponse object from raw response bytes.</span>
<span class="sd">    This method is used to convert the raw response bytes received from a REST API into an InferResponse object.</span>

<span class="sd">    Args:</span>
<span class="sd">        res_bytes (bytes): The raw response bytes received from the REST API.</span>
<span class="sd">        json_length (int): The length of the JSON part of the response.</span>

<span class="sd">    Returns:</span>
<span class="sd">        InferResponse: The constructed InferResponse object.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InvalidInput: If the response format is unrecognized or if necessary fields are missing in the response.</span>
<span class="sd">        InferenceError: if failed to set data for the output tensor.</span>
<span class="sd">    """</span>
    <span class="c1"># If json_length is equal to the length of the response bytes, then the response does not have</span>
    <span class="c1"># any appended binary data after the json.</span>
    <span class="n">json_bytes</span> <span class="o">=</span> <span class="n">res_bytes</span><span class="p">[:</span><span class="n">json_length</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">infer_res_dict</span> <span class="o">=</span> <span class="n">orjson</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_bytes</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">orjson</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Unrecognized request format: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">infer_res_dict</span><span class="p">[</span><span class="s2">"model_name"</span><span class="p">]</span>
    <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Read the raw binary outputs appended after json</span>
    <span class="n">start_index</span> <span class="o">=</span> <span class="n">json_length</span>
    <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">infer_res_dict</span><span class="p">[</span><span class="s2">"outputs"</span><span class="p">]:</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">infer_output</span> <span class="o">=</span> <span class="n">InferOutput</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span>
            <span class="n">shape</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"shape"</span><span class="p">],</span>
            <span class="n">datatype</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"datatype"</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">parameters</span> <span class="ow">and</span> <span class="s2">"binary_data_size"</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
            <span class="n">binary_data_size</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"binary_data_size"</span><span class="p">)</span>
            <span class="n">end_index</span> <span class="o">=</span> <span class="n">start_index</span> <span class="o">+</span> <span class="n">binary_data_size</span>
            <span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span> <span class="o">=</span> <span class="n">res_bytes</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]</span>
            <span class="n">infer_output</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">(),</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">start_index</span> <span class="o">=</span> <span class="n">end_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infer_output_data</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">infer_output_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">"'data' field is missing for output '</span><span class="si">{</span><span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
                <span class="p">)</span>
            <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">infer_output_data</span>
        <span class="n">infer_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">response_id</span><span class="o">=</span><span class="n">infer_res_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">infer_res_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">infer_outputs</span><span class="o">=</span><span class="n">infer_outputs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferResponse.from_grpc">
<code class="highlight language-python"><span class="n">from_grpc</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferResponse.from_grpc" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The class method to construct the InferResponse object from gRPC message type.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>response</code></td>
<td>
<code><span title="kserve.protocol.grpc.grpc_predict_v2_pb2.ModelInferResponse">ModelInferResponse</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The GRPC response as ModelInferResponse object.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_grpc</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">ModelInferResponse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferResponse"</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The class method to construct the InferResponse object from gRPC message type.</span>

<span class="sd">    Args:</span>
<span class="sd">        response: The GRPC response as ModelInferResponse object.</span>
<span class="sd">    Returns:</span>
<span class="sd">        InferResponse object.</span>
<span class="sd">    """</span>
    <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">InferOutput</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">shape</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
            <span class="n">datatype</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">get_content</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">contents</span><span class="p">),</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">outputs</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">model_version</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">model_version</span><span class="p">,</span>
        <span class="n">response_id</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
        <span class="n">infer_outputs</span><span class="o">=</span><span class="n">infer_outputs</span><span class="p">,</span>
        <span class="n">raw_outputs</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">raw_output_contents</span><span class="p">,</span>
        <span class="n">from_grpc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferResponse.from_rest">
<code class="highlight language-python"><span class="n">from_rest</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.InferResponse.from_rest" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The class method to construct the InferResponse object from REST message type.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>response</code></td>
<td>
<code><span title="typing.Dict">Dict</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The response as a dict.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_rest</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">"InferResponse"</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""The class method to construct the InferResponse object from REST message type.</span>

<span class="sd">    Args:</span>
<span class="sd">        response: The response as a dict.</span>
<span class="sd">    Returns:</span>
<span class="sd">        InferResponse object.</span>
<span class="sd">    """</span>
    <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">InferOutput</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span>
            <span class="n">shape</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">output</span><span class="p">[</span><span class="s2">"shape"</span><span class="p">]),</span>
            <span class="n">datatype</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"datatype"</span><span class="p">],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">output</span><span class="p">[</span><span class="s2">"data"</span><span class="p">],</span>
            <span class="n">parameters</span><span class="o">=</span><span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">"outputs"</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">model_name</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"model_name"</span><span class="p">),</span>
        <span class="n">model_version</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"model_version"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">response_id</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"id"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"parameters"</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="n">infer_outputs</span><span class="o">=</span><span class="n">infer_outputs</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferResponse.get_output_by_name">
<code class="highlight language-python"><span class="n">get_output_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferResponse.get_output_by_name" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Find an output Tensor in the InferResponse that has the given name</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>name</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>str
name of the output Tensor object</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_output_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">InferOutput</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Find an output Tensor in the InferResponse that has the given name</span>

<span class="sd">    Args:</span>
<span class="sd">        name : str</span>
<span class="sd">            name of the output Tensor object</span>
<span class="sd">    Returns:</span>
<span class="sd">        InferOutput</span>
<span class="sd">            The InferOutput with the specified name, or None if no</span>
<span class="sd">            output with this name exists</span>
<span class="sd">    """</span>
    <span class="k">for</span> <span class="n">infer_output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">infer_output</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferResponse.to_grpc">
<code class="highlight language-python"><span class="n">to_grpc</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferResponse.to_grpc" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Converts the InferResponse object to gRPC ModelInferResponse type.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="kserve.protocol.grpc.grpc_predict_v2_pb2.ModelInferResponse">ModelInferResponse</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The ModelInferResponse gRPC message.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_grpc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelInferResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Converts the InferResponse object to gRPC ModelInferResponse type.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The ModelInferResponse gRPC message.</span>
<span class="sd">    Raises:</span>
<span class="sd">        InvalidInput: If the output data is not a List or if the datatype is invalid.</span>
<span class="sd">    """</span>
    <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">raw_output_contents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">use_raw_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_binary_outputs</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_binary_outputs</span><span class="p">:</span>
        <span class="c1"># If FP16 datatype is present in the outputs use raw outputs.</span>
        <span class="k">if</span> <span class="n">_contains_fp16_datatype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">use_raw_outputs</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">infer_output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">use_raw_outputs</span>
            <span class="ow">and</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span>
            <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">infer_output</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">infer_output_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">"shape"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="s2">"datatype"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_grpc_parameters</span><span class="p">(</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">parameters</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">raw_output_contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"output data is not a List"</span><span class="p">)</span>
            <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"contents"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">data_key</span> <span class="o">=</span> <span class="n">GRPC_CONTENT_DATATYPE_MAPPINGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">data_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="nb">bytes</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">"utf-8"</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">val</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span>
                <span class="p">]</span>  <span class="c1"># str to byte conversion for grpc proto</span>
                <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"contents"</span><span class="p">][</span><span class="n">data_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="s2">"to_grpc: invalid output datatype"</span><span class="p">)</span>
        <span class="n">infer_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output_dict</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ModelInferResponse</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">model_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="n">model_version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_version</span><span class="p">,</span>
        <span class="n">outputs</span><span class="o">=</span><span class="n">infer_outputs</span><span class="p">,</span>
        <span class="n">raw_output_contents</span><span class="o">=</span><span class="n">raw_output_contents</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">to_grpc_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.InferResponse.to_rest">
<code class="highlight language-python"><span class="n">to_rest</span><span class="p">()</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.InferResponse.to_rest" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Converts the InferResponse object to v2 REST InferResponse Dict or bytes.
This method is used to convert the InferResponse object into a format that can be sent over a REST API.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Tuple">Tuple</span>[<span title="typing.Union">Union</span>[bytes, <span title="typing.Dict">Dict</span>], <span title="typing.Optional">Optional</span>[int]]</code>
</td>
<td>
<div class="doc-md-description">
<p>Tuple[Union[bytes, Dict], Optional[int]]: A tuple containing the InferResponse in bytes or Dict and the length of the JSON part of the response.
                                      If it is dict, then the json length will be None.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="kserve.errors.InvalidInput">InvalidInput</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the output data is not a numpy array, bytes, or list.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">Dict</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Converts the InferResponse object to v2 REST InferResponse Dict or bytes.</span>
<span class="sd">    This method is used to convert the InferResponse object into a format that can be sent over a REST API.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[Union[bytes, Dict], Optional[int]]: A tuple containing the InferResponse in bytes or Dict and the length of the JSON part of the response.</span>
<span class="sd">                                                  If it is dict, then the json length will be None.</span>

<span class="sd">    Raises:</span>
<span class="sd">        InvalidInput: If the output data is not a numpy array, bytes, or list.</span>
<span class="sd">    """</span>
    <span class="n">infer_outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">raw_outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">use_binary_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_use_binary_outputs</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span>

    <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">:</span>
        <span class="n">infer_output</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_output_by_name</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span>
            <span class="k">else</span> <span class="n">output</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requested_outputs</span><span class="p">:</span>
            <span class="n">use_binary_data</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">binary_data</span>
        <span class="k">if</span> <span class="n">infer_output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Unexpected inference output '</span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"'data' field is missing for output '</span><span class="si">{</span><span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' for model '</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">'"</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">infer_output</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">binary_data</span><span class="o">=</span><span class="n">use_binary_data</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span> <span class="ow">or</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">:</span>
            <span class="n">infer_output</span><span class="o">.</span><span class="n">set_data_from_numpy</span><span class="p">(</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">as_numpy</span><span class="p">(),</span> <span class="n">binary_data</span><span class="o">=</span><span class="n">use_binary_data</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">datatype</span> <span class="o">==</span> <span class="s2">"FP16"</span> <span class="ow">and</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">"Sending FP16 data via JSON is not supported. Please use the binary data format for output </span><span class="si">{</span><span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span>
            <span class="p">)</span>

        <span class="n">infer_output_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"name"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">"shape"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
            <span class="s2">"datatype"</span><span class="p">:</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">datatype</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span>
                <span class="n">infer_output</span><span class="o">.</span><span class="n">parameters</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">use_binary_data</span><span class="p">:</span>
            <span class="n">raw_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output</span><span class="o">.</span><span class="n">_raw_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">infer_output_dict</span><span class="p">[</span><span class="s2">"data"</span><span class="p">]</span> <span class="o">=</span> <span class="n">infer_output</span><span class="o">.</span><span class="n">data</span>
        <span class="n">infer_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">infer_output_dict</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="s2">"model_name"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
        <span class="s2">"model_version"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_version</span><span class="p">,</span>
        <span class="s2">"outputs"</span><span class="p">:</span> <span class="n">infer_outputs</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
        <span class="n">res</span><span class="p">[</span><span class="s2">"parameters"</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_http_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_outputs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">infer_response_bytes</span> <span class="o">=</span> <span class="n">orjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="n">json_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">infer_response_bytes</span><span class="p">)</span>
        <span class="n">infer_response_bytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">infer_response_bytes</span><span class="p">]</span> <span class="o">+</span> <span class="n">raw_outputs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">infer_response_bytes</span><span class="p">,</span> <span class="n">json_length</span>

    <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="kserve.protocol.infer_type.RequestedOutput">
<code>RequestedOutput</code>
<a class="headerlink" href="#kserve.protocol.infer_type.RequestedOutput" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RequestedOutput</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        The RequestedOutput class represents an output that is requested as part of an inference request.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the output.</span>
<span class="sd">            parameters (Optional[Dict]): Additional parameters for the output.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the name of the output.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The name of the output.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""</span>
<span class="sd">        Get the additional parameters for the output.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Dict]: The additional parameters for the output.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span>

    <span class="nd">@parameters</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">"""Set the parameters of the inference input associated with this object.</span>

<span class="sd">        Args:</span>
<span class="sd">             params: parameters of the inference input</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">params</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">binary_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get the binary_data attribute from the parameters.</span>
<span class="sd">        This attribute indicates whether the data for the input should be in binary format.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool or None: True if the data should be in binary format, False otherwise.</span>
<span class="sd">                              If the binary_data attribute is not set, returns None.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">and</span> <span class="s2">"binary_data"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">"binary_data"</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">RequestedOutput</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">"RequestedOutput(name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, parameters=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="si">}</span><span class="s2">)"</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.RequestedOutput.binary_data">
<code class="highlight language-python"><span class="n">binary_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.RequestedOutput.binary_data" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the binary_data attribute from the parameters.
This attribute indicates whether the data for the input should be in binary format.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Optional">Optional</span>[bool]</code>
</td>
<td>
<div class="doc-md-description">
<p>bool or None: True if the data should be in binary format, False otherwise.
              If the binary_data attribute is not set, returns None.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.RequestedOutput.name">
<code class="highlight language-python"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.RequestedOutput.name" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the name of the output.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>str</code></td> <td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of the output.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.RequestedOutput.parameters">
<code class="highlight language-python"><span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-property"><code>property</code></small>
<small class="doc doc-label doc-label-writable"><code>writable</code></small>
</span>
<a class="headerlink" href="#kserve.protocol.infer_type.RequestedOutput.parameters" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>Get the additional parameters for the output.</p>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Optional[Dict]: The additional parameters for the output.</p>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="kserve.protocol.infer_type.RequestedOutput.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.RequestedOutput.__init__" title="Permanent link"></a></h3>
<div class="doc doc-contents">
<p>The RequestedOutput class represents an output that is requested as part of an inference request.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>name</code></td>
<td>
<code>str</code>
</td>
<td>
<div class="doc-md-description">
<p>The name of the output.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td><code>parameters</code></td>
<td>
<code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>Additional parameters for the output.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    The RequestedOutput class represents an output that is requested as part of an inference request.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the output.</span>
<span class="sd">        parameters (Optional[Dict]): Additional parameters for the output.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="n">parameters</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="kserve.protocol.infer_type.deserialize_bytes_tensor">
<code class="highlight language-python"><span class="n">deserialize_bytes_tensor</span><span class="p">(</span><span class="n">encoded_tensor</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.deserialize_bytes_tensor" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Deserializes an encoded bytes tensor into a
numpy array of dtype of python objects</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>encoded_tensor</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>bytes
The encoded bytes tensor where each element
has its length in first 4 bytes followed by
the content</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">deserialize_bytes_tensor</span><span class="p">(</span><span class="n">encoded_tensor</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Deserializes an encoded bytes tensor into a</span>
<span class="sd">    numpy array of dtype of python objects</span>

<span class="sd">    Args:</span>
<span class="sd">        encoded_tensor : bytes</span>
<span class="sd">            The encoded bytes tensor where each element</span>
<span class="sd">            has its length in first 4 bytes followed by</span>
<span class="sd">            the content</span>
<span class="sd">    Returns:</span>
<span class="sd">        string_tensor : np.array</span>
<span class="sd">            The 1-D numpy array of type object containing the</span>
<span class="sd">            deserialized bytes in row-major form.</span>
<span class="sd">    """</span>
    <span class="n">strs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">val_buf</span> <span class="o">=</span> <span class="n">encoded_tensor</span>
    <span class="k">while</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_buf</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="s2">"&lt;I"</span><span class="p">,</span> <span class="n">val_buf</span><span class="p">,</span> <span class="n">offset</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">+=</span> <span class="mi">4</span>
        <span class="n">sb</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="s2">"&lt;</span><span class="si">{}</span><span class="s2">s"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">),</span> <span class="n">val_buf</span><span class="p">,</span> <span class="n">offset</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">+=</span> <span class="n">length</span>
        <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sb</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">strs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="kserve.protocol.infer_type.serialize_byte_tensor">
<code class="highlight language-python"><span class="n">serialize_byte_tensor</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.serialize_byte_tensor" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Serializes a bytes tensor into a flat numpy array of length prepended
bytes. The numpy array should use dtype of np.object. For np.bytes,
numpy will remove trailing zeros at the end of byte sequence and because
of this it should be avoided.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>input_tensor</code></td>
<td>
</td>
<td>
<div class="doc-md-description">
<p>np.array
The bytes tensor to serialize.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">serialize_byte_tensor</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Serializes a bytes tensor into a flat numpy array of length prepended</span>
<span class="sd">    bytes. The numpy array should use dtype of np.object. For np.bytes,</span>
<span class="sd">    numpy will remove trailing zeros at the end of byte sequence and because</span>
<span class="sd">    of this it should be avoided.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_tensor : np.array</span>
<span class="sd">            The bytes tensor to serialize.</span>
<span class="sd">    Returns:</span>
<span class="sd">        serialized_bytes_tensor : np.array</span>
<span class="sd">            The 1-D numpy array of type uint8 containing the serialized bytes in row-major form.</span>
<span class="sd">    Raises:</span>
<span class="sd">        InferenceError If unable to serialize the given tensor.</span>
<span class="sd">    """</span>

    <span class="k">if</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">)</span>

    <span class="c1"># If the input is a tensor of string/bytes objects, then must flatten those into</span>
    <span class="c1"># a 1-dimensional array containing the 4-byte byte size followed by the</span>
    <span class="c1"># actual element bytes. All elements are concatenated together in row-major</span>
    <span class="c1"># order.</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">input_tensor</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">bytes_</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">InferenceError</span><span class="p">(</span><span class="s2">"cannot serialize bytes tensor: invalid datatype"</span><span class="p">)</span>

    <span class="n">flattened_ls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># 'C' order is row-major.</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">(</span><span class="n">input_tensor</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s2">"refs_ok"</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">"C"</span><span class="p">):</span>
        <span class="c1"># If directly passing bytes to BYTES type,</span>
        <span class="c1"># don't convert it to str as Python will encode the</span>
        <span class="c1"># bytes which may distort the meaning</span>
        <span class="k">if</span> <span class="n">input_tensor</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">flattened_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">"&lt;I"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
        <span class="n">flattened_ls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">flattened</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">""</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flattened_ls</span><span class="p">)</span>
    <span class="n">flattened_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">flattened</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flattened_array</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s2">"C_CONTIGUOUS"</span><span class="p">]:</span>
        <span class="n">flattened_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">flattened_array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">object_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flattened_array</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="kserve.protocol.infer_type.to_grpc_parameters">
<code class="highlight language-python"><span class="n">to_grpc_parameters</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.to_grpc_parameters" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Converts REST parameters to GRPC InferParameter objects</p>
<p>:param parameters: parameters to be converted.
:return: converted parameters as Dict[str, InferParameter]
:raises InvalidInput: if the parameter type is not supported.</p>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_grpc_parameters</span><span class="p">(</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Converts REST parameters to GRPC InferParameter objects</span>

<span class="sd">    :param parameters: parameters to be converted.</span>
<span class="sd">    :return: converted parameters as Dict[str, InferParameter]</span>
<span class="sd">    :raises InvalidInput: if the parameter type is not supported.</span>
<span class="sd">    """</span>
    <span class="n">grpc_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">grpc_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">InferParameter</span><span class="p">(</span><span class="n">string_param</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">grpc_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">InferParameter</span><span class="p">(</span><span class="n">bool_param</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">grpc_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">InferParameter</span><span class="p">(</span><span class="n">int64_param</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">):</span>
            <span class="n">grpc_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidInput</span><span class="p">(</span><span class="sa">f</span><span class="s2">"to_grpc: invalid parameter value: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grpc_params</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="kserve.protocol.infer_type.to_http_parameters">
<code class="highlight language-python"><span class="n">to_http_parameters</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span></code>
<a class="headerlink" href="#kserve.protocol.infer_type.to_http_parameters" title="Permanent link"></a></h2>
<div class="doc doc-contents">
<p>Converts GRPC InferParameter parameters to REST parameters</p>
<p>:param parameters: parameters to be converted.
:return: converted parameters as Dict[str, Union[str, bool, int]]</p>
<details class="quote">
<summary>Source code in <code>kserve/protocol/infer_type.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_http_parameters</span><span class="p">(</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="n">MessageMap</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Converts GRPC InferParameter parameters to REST parameters</span>

<span class="sd">    :param parameters: parameters to be converted.</span>
<span class="sd">    :return: converted parameters as Dict[str, Union[str, bool, int]]</span>
<span class="sd">    """</span>
    <span class="n">http_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">InferParameter</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">"bool_param"</span><span class="p">):</span>
                <span class="n">http_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">bool_param</span>
            <span class="k">elif</span> <span class="n">val</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">"int64_param"</span><span class="p">):</span>
                <span class="n">http_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">int64_param</span>
            <span class="k">elif</span> <span class="n">val</span><span class="o">.</span><span class="n">HasField</span><span class="p">(</span><span class="s2">"string_param"</span><span class="p">):</span>
                <span class="n">http_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">string_param</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">http_params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
    <span class="k">return</span> <span class="n">http_params</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright  2021 The KServe Authors
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/kserve" rel="noopener" target="_blank" title="KServe Community on Github">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://github.com/kserve/community/blob/main/README.md#questions-and-issues" rel="noopener" target="_blank" title="Join Slack">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tracking", "navigation.tabs.sticky", "navigation.top"], "search": "../../../assets/javascripts/workers/search.cefbb252.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../../../assets/javascripts/bundle.a5f8ea78.min.js"></script>
<script>document$.subscribe(() => {
            window.update_swagger_ui_iframe_height = function (id) {
                var iFrameID = document.getElementById(id);
                if (iFrameID) {
                    full_height = (iFrameID.contentWindow.document.body.scrollHeight + 80) + "px";
                    iFrameID.height = full_height;
                    iFrameID.style.height = full_height;
                }
            }
        
            let iframe_id_list = []
            var iframes = document.getElementsByClassName("swagger-ui-iframe");
            for (var i = 0; i < iframes.length; i++) { 
                iframe_id_list.push(iframes[i].getAttribute("id"))
            }
        
            let ticking = true;
            
            document.addEventListener('scroll', function(e) {
                if (!ticking) {
                    window.requestAnimationFrame(()=> {
                        let half_vh = window.innerHeight/2;
                        for(var i = 0; i < iframe_id_list.length; i++) {
                            let element = document.getElementById(iframe_id_list[i])
                            if(element==null){
                                return
                            }
                            let diff = element.getBoundingClientRect().top
                            if(element.contentWindow.update_top_val){
                                element.contentWindow.update_top_val(half_vh - diff)
                            }
                        }
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("swagger-ui-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script></body>
</html>